\hypertarget{binary__to__compressed__c_8cpp_source}{}\doxysection{binary\+\_\+to\+\_\+compressed\+\_\+c.\+cpp}
\label{binary__to__compressed__c_8cpp_source}\index{/Users/cwb/developer/learning/graphicRenderEngine/ceres/3rdparty/imgui/misc/fonts/binary\_to\_compressed\_c.cpp@{/Users/cwb/developer/learning/graphicRenderEngine/ceres/3rdparty/imgui/misc/fonts/binary\_to\_compressed\_c.cpp}}

\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00001}00001 \textcolor{comment}{// dear imgui}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00002}00002 \textcolor{comment}{// (binary\_to\_compressed\_c.cpp)}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00003}00003 \textcolor{comment}{// Helper tool to turn a file into a C array, if you want to embed font data in your source code.}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00004}00004 }
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00005}00005 \textcolor{comment}{// The data is first compressed with stb\_compress() to reduce source code size,}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00006}00006 \textcolor{comment}{// then encoded in Base85 to fit in a string so we can fit roughly 4 bytes of compressed data into 5 bytes of source code (suggested by @mmalex)}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00007}00007 \textcolor{comment}{// (If we used 32-\/bit constants it would require take 11 bytes of source code to encode 4 bytes, and be endianness dependent)}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00008}00008 \textcolor{comment}{// Note that even with compression, the output array is likely to be bigger than the binary file..}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00009}00009 \textcolor{comment}{// Load compressed TTF fonts with ImGui::GetIO().Fonts-\/>AddFontFromMemoryCompressedTTF()}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00010}00010 }
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00011}00011 \textcolor{comment}{// Build with, e.g:}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00012}00012 \textcolor{comment}{//   \# cl.exe binary\_to\_compressed\_c.cpp}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00013}00013 \textcolor{comment}{//   \# g++ binary\_to\_compressed\_c.cpp}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00014}00014 \textcolor{comment}{//   \# clang++ binary\_to\_compressed\_c.cpp}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00015}00015 \textcolor{comment}{// You can also find a precompiled Windows binary in the binary/demo package available from https://github.com/ocornut/imgui}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00016}00016 }
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00017}00017 \textcolor{comment}{// Usage:}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00018}00018 \textcolor{comment}{//   binary\_to\_compressed\_c.exe [-\/base85] [-\/nocompress] <inputfile> <symbolname>}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00019}00019 \textcolor{comment}{// Usage example:}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00020}00020 \textcolor{comment}{//   \# binary\_to\_compressed\_c.exe myfont.ttf MyFont > myfont.cpp}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00021}00021 \textcolor{comment}{//   \# binary\_to\_compressed\_c.exe -\/base85 myfont.ttf MyFont > myfont.cpp}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00022}00022 }
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00023}00023 \textcolor{preprocessor}{\#define \_CRT\_SECURE\_NO\_WARNINGS}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00024}00024 \textcolor{preprocessor}{\#include <stdio.h>}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00025}00025 \textcolor{preprocessor}{\#include <string.h>}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00026}00026 \textcolor{preprocessor}{\#include <stdlib.h>}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00027}00027 \textcolor{preprocessor}{\#include <assert.h>}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00028}00028 }
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00029}00029 \textcolor{comment}{// stb\_compress* from stb.h -\/ declaration}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00030}00030 \textcolor{keyword}{typedef} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} stb\_uint;}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00031}00031 \textcolor{keyword}{typedef} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} stb\_uchar;}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00032}00032 stb\_uint stb\_compress(stb\_uchar* out, stb\_uchar* in, stb\_uint len);}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00033}00033 }
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00034}00034 \textcolor{keyword}{static} \textcolor{keywordtype}{bool} binary\_to\_compressed\_c(\textcolor{keyword}{const} \textcolor{keywordtype}{char}* filename, \textcolor{keyword}{const} \textcolor{keywordtype}{char}* symbol, \textcolor{keywordtype}{bool} use\_base85\_encoding, \textcolor{keywordtype}{bool} use\_compression);}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00035}00035 }
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00036}00036 \textcolor{keywordtype}{int} main(\textcolor{keywordtype}{int} argc, \textcolor{keywordtype}{char}** argv)}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00037}00037 \{}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00038}00038     \textcolor{keywordflow}{if} (argc < 3)}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00039}00039     \{}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00040}00040         printf(\textcolor{stringliteral}{"{}Syntax: \%s [-\/base85] [-\/nocompress] <inputfile> <symbolname>\(\backslash\)n"{}}, argv[0]);}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00041}00041         \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00042}00042     \}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00043}00043 }
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00044}00044     \textcolor{keywordtype}{int} argn = 1;}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00045}00045     \textcolor{keywordtype}{bool} use\_base85\_encoding = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00046}00046     \textcolor{keywordtype}{bool} use\_compression = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00047}00047     \textcolor{keywordflow}{if} (argv[argn][0] == \textcolor{charliteral}{'-\/'})}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00048}00048     \{}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00049}00049         \textcolor{keywordflow}{if} (strcmp(argv[argn], \textcolor{stringliteral}{"{}-\/base85"{}}) == 0) \{ use\_base85\_encoding = \textcolor{keyword}{true}; argn++; \}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00050}00050         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (strcmp(argv[argn], \textcolor{stringliteral}{"{}-\/nocompress"{}}) == 0) \{ use\_compression = \textcolor{keyword}{false}; argn++; \}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00051}00051         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00052}00052         \{}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00053}00053             fprintf(stderr, \textcolor{stringliteral}{"{}Unknown argument: '\%s'\(\backslash\)n"{}}, argv[argn]);}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00054}00054             \textcolor{keywordflow}{return} 1;}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00055}00055         \}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00056}00056     \}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00057}00057 }
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00058}00058     \textcolor{keywordtype}{bool} ret = binary\_to\_compressed\_c(argv[argn], argv[argn + 1], use\_base85\_encoding, use\_compression);}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00059}00059     \textcolor{keywordflow}{if} (!ret)}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00060}00060         fprintf(stderr, \textcolor{stringliteral}{"{}Error opening or reading file: '\%s'\(\backslash\)n"{}}, argv[argn]);}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00061}00061     \textcolor{keywordflow}{return} ret ? 0 : 1;}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00062}00062 \}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00063}00063 }
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00064}00064 \textcolor{keywordtype}{char} Encode85Byte(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} x)}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00065}00065 \{}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00066}00066     x = (x \% 85) + 35;}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00067}00067     \textcolor{keywordflow}{return} (x >= \textcolor{charliteral}{'\(\backslash\)\(\backslash\)'}) ? x + 1 : x;}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00068}00068 \}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00069}00069 }
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00070}00070 \textcolor{keywordtype}{bool} binary\_to\_compressed\_c(\textcolor{keyword}{const} \textcolor{keywordtype}{char}* filename, \textcolor{keyword}{const} \textcolor{keywordtype}{char}* symbol, \textcolor{keywordtype}{bool} use\_base85\_encoding, \textcolor{keywordtype}{bool} use\_compression)}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00071}00071 \{}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00072}00072     \textcolor{comment}{// Read file}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00073}00073     FILE* f = fopen(filename, \textcolor{stringliteral}{"{}rb"{}});}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00074}00074     \textcolor{keywordflow}{if} (!f) \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00075}00075     \textcolor{keywordtype}{int} data\_sz;}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00076}00076     \textcolor{keywordflow}{if} (fseek(f, 0, SEEK\_END) || (data\_sz = (\textcolor{keywordtype}{int})ftell(f)) == -\/1 || fseek(f, 0, SEEK\_SET)) \{ fclose(f); \textcolor{keywordflow}{return} \textcolor{keyword}{false}; \}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00077}00077     \textcolor{keywordtype}{char}* data = \textcolor{keyword}{new} \textcolor{keywordtype}{char}[data\_sz + 4];}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00078}00078     \textcolor{keywordflow}{if} (fread(data, 1, data\_sz, f) != (\textcolor{keywordtype}{size\_t})data\_sz) \{ fclose(f); \textcolor{keyword}{delete}[] data; \textcolor{keywordflow}{return} \textcolor{keyword}{false}; \}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00079}00079     memset((\textcolor{keywordtype}{void}*)(((\textcolor{keywordtype}{char}*)data) + data\_sz), 0, 4);}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00080}00080     fclose(f);}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00081}00081 }
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00082}00082     \textcolor{comment}{// Compress}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00083}00083     \textcolor{keywordtype}{int} maxlen = data\_sz + 512 + (data\_sz >> 2) + \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{int}); \textcolor{comment}{// total guess}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00084}00084     \textcolor{keywordtype}{char}* compressed = use\_compression ? \textcolor{keyword}{new} \textcolor{keywordtype}{char}[maxlen] : data;}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00085}00085     \textcolor{keywordtype}{int} compressed\_sz = use\_compression ? stb\_compress((stb\_uchar*)compressed, (stb\_uchar*)data, data\_sz) : data\_sz;}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00086}00086     \textcolor{keywordflow}{if} (use\_compression)}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00087}00087         memset(compressed + compressed\_sz, 0, maxlen -\/ compressed\_sz);}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00088}00088 }
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00089}00089     \textcolor{comment}{// Output as Base85 encoded}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00090}00090     FILE* out = stdout;}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00091}00091     fprintf(out, \textcolor{stringliteral}{"{}// File: '\%s' (\%d bytes)\(\backslash\)n"{}}, filename, (\textcolor{keywordtype}{int})data\_sz);}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00092}00092     fprintf(out, \textcolor{stringliteral}{"{}// Exported using binary\_to\_compressed\_c.cpp\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00093}00093     \textcolor{keyword}{const} \textcolor{keywordtype}{char}* compressed\_str = use\_compression ? \textcolor{stringliteral}{"{}compressed\_"{}} : \textcolor{stringliteral}{"{}"{}};}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00094}00094     \textcolor{keywordflow}{if} (use\_base85\_encoding)}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00095}00095     \{}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00096}00096         fprintf(out, \textcolor{stringliteral}{"{}static const char \%s\_\%sdata\_base85[\%d+1] =\(\backslash\)n    \(\backslash\)"{}"{}}, symbol, compressed\_str, (\textcolor{keywordtype}{int})((compressed\_sz + 3) / 4)*5);}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00097}00097         \textcolor{keywordtype}{char} prev\_c = 0;}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00098}00098         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} src\_i = 0; src\_i < compressed\_sz; src\_i += 4)}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00099}00099         \{}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00100}00100             \textcolor{comment}{// This is made a little more complicated by the fact that ??X sequences are interpreted as trigraphs by old C/C++ compilers. So we need to escape pairs of ??.}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00101}00101             \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} d = *(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}*)(compressed + src\_i);}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00102}00102             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} n5 = 0; n5 < 5; n5++, d /= 85)}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00103}00103             \{}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00104}00104                 \textcolor{keywordtype}{char} c = Encode85Byte(d);}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00105}00105                 fprintf(out, (c == \textcolor{charliteral}{'?'} \&\& prev\_c == \textcolor{charliteral}{'?'}) ? \textcolor{stringliteral}{"{}\(\backslash\)\(\backslash\)\%c"{}} : \textcolor{stringliteral}{"{}\%c"{}}, c);}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00106}00106                 prev\_c = c;}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00107}00107             \}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00108}00108             \textcolor{keywordflow}{if} ((src\_i \% 112) == 112 -\/ 4)}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00109}00109                 fprintf(out, \textcolor{stringliteral}{"{}\(\backslash\)"{}\(\backslash\)n    \(\backslash\)"{}"{}});}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00110}00110         \}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00111}00111         fprintf(out, \textcolor{stringliteral}{"{}\(\backslash\)"{};\(\backslash\)n\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00112}00112     \}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00113}00113     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00114}00114     \{}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00115}00115         fprintf(out, \textcolor{stringliteral}{"{}static const unsigned int \%s\_\%ssize = \%d;\(\backslash\)n"{}}, symbol, compressed\_str, (\textcolor{keywordtype}{int})compressed\_sz);}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00116}00116         fprintf(out, \textcolor{stringliteral}{"{}static const unsigned int \%s\_\%sdata[\%d/4] =\(\backslash\)n\{"{}}, symbol, compressed\_str, (\textcolor{keywordtype}{int})((compressed\_sz + 3) / 4)*4);}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00117}00117         \textcolor{keywordtype}{int} column = 0;}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00118}00118         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < compressed\_sz; i += 4)}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00119}00119         \{}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00120}00120             \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} d = *(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}*)(compressed + i);}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00121}00121             \textcolor{keywordflow}{if} ((column++ \% 12) == 0)}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00122}00122                 fprintf(out, \textcolor{stringliteral}{"{}\(\backslash\)n    0x\%08x, "{}}, d);}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00123}00123             \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00124}00124                 fprintf(out, \textcolor{stringliteral}{"{}0x\%08x, "{}}, d);}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00125}00125         \}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00126}00126         fprintf(out, \textcolor{stringliteral}{"{}\(\backslash\)n\};\(\backslash\)n\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00127}00127     \}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00128}00128 }
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00129}00129     \textcolor{comment}{// Cleanup}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00130}00130     \textcolor{keyword}{delete}[] data;}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00131}00131     \textcolor{keywordflow}{if} (use\_compression)}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00132}00132         \textcolor{keyword}{delete}[] compressed;}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00133}00133     \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00134}00134 \}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00135}00135 }
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00136}00136 \textcolor{comment}{// stb\_compress* from stb.h -\/ definition}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00137}00137 }
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00139}00139 }
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00140}00140 \textcolor{keyword}{static} stb\_uint stb\_adler32(stb\_uint adler32, stb\_uchar *\mbox{\hyperlink{classbuffer}{buffer}}, stb\_uint buflen)}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00141}00141 \{}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00142}00142     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} ADLER\_MOD = 65521;}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00143}00143     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} s1 = adler32 \& 0xffff, s2 = adler32 >> 16;}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00144}00144     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} blocklen, i;}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00145}00145 }
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00146}00146     blocklen = buflen \% 5552;}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00147}00147     \textcolor{keywordflow}{while} (buflen) \{}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00148}00148         \textcolor{keywordflow}{for} (i=0; i + 7 < blocklen; i += 8) \{}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00149}00149             s1 += \mbox{\hyperlink{classbuffer}{buffer}}[0], s2 += s1;}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00150}00150             s1 += \mbox{\hyperlink{classbuffer}{buffer}}[1], s2 += s1;}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00151}00151             s1 += \mbox{\hyperlink{classbuffer}{buffer}}[2], s2 += s1;}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00152}00152             s1 += \mbox{\hyperlink{classbuffer}{buffer}}[3], s2 += s1;}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00153}00153             s1 += \mbox{\hyperlink{classbuffer}{buffer}}[4], s2 += s1;}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00154}00154             s1 += \mbox{\hyperlink{classbuffer}{buffer}}[5], s2 += s1;}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00155}00155             s1 += \mbox{\hyperlink{classbuffer}{buffer}}[6], s2 += s1;}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00156}00156             s1 += \mbox{\hyperlink{classbuffer}{buffer}}[7], s2 += s1;}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00157}00157 }
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00158}00158             \mbox{\hyperlink{classbuffer}{buffer}} += 8;}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00159}00159         \}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00160}00160 }
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00161}00161         \textcolor{keywordflow}{for} (; i < blocklen; ++i)}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00162}00162             s1 += *\mbox{\hyperlink{classbuffer}{buffer}}++, s2 += s1;}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00163}00163 }
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00164}00164         s1 \%= ADLER\_MOD, s2 \%= ADLER\_MOD;}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00165}00165         buflen -\/= blocklen;}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00166}00166         blocklen = 5552;}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00167}00167     \}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00168}00168     \textcolor{keywordflow}{return} (s2 << 16) + s1;}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00169}00169 \}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00170}00170 }
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00171}00171 \textcolor{keyword}{static} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} stb\_matchlen(stb\_uchar *m1, stb\_uchar *m2, stb\_uint maxlen)}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00172}00172 \{}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00173}00173     stb\_uint i;}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00174}00174     \textcolor{keywordflow}{for} (i=0; i < maxlen; ++i)}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00175}00175         \textcolor{keywordflow}{if} (m1[i] != m2[i]) \textcolor{keywordflow}{return} i;}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00176}00176     \textcolor{keywordflow}{return} i;}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00177}00177 \}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00178}00178 }
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00179}00179 \textcolor{comment}{// simple implementation that just takes the source data in a big block}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00180}00180 }
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00181}00181 \textcolor{keyword}{static} stb\_uchar *stb\_\_out;}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00182}00182 \textcolor{keyword}{static} FILE      *stb\_\_outfile;}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00183}00183 \textcolor{keyword}{static} stb\_uint   stb\_\_outbytes;}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00184}00184 }
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00185}00185 \textcolor{keyword}{static} \textcolor{keywordtype}{void} stb\_\_write(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} v)}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00186}00186 \{}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00187}00187     fputc(v, stb\_\_outfile);}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00188}00188     ++stb\_\_outbytes;}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00189}00189 \}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00190}00190 }
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00191}00191 \textcolor{comment}{//\#define stb\_out(v)    (stb\_\_out ? *stb\_\_out++ = (stb\_uchar) (v) : stb\_\_write((stb\_uchar) (v)))}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00192}00192 \textcolor{preprocessor}{\#define stb\_out(v)    do \{ if (stb\_\_out) *stb\_\_out++ = (stb\_uchar) (v); else stb\_\_write((stb\_uchar) (v)); \} while (0)}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00193}00193 }
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00194}00194 \textcolor{keyword}{static} \textcolor{keywordtype}{void} stb\_out2(stb\_uint v) \{ stb\_out(v >> 8); stb\_out(v); \}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00195}00195 \textcolor{keyword}{static} \textcolor{keywordtype}{void} stb\_out3(stb\_uint v) \{ stb\_out(v >> 16); stb\_out(v >> 8); stb\_out(v); \}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00196}00196 \textcolor{keyword}{static} \textcolor{keywordtype}{void} stb\_out4(stb\_uint v) \{ stb\_out(v >> 24); stb\_out(v >> 16); stb\_out(v >> 8 ); stb\_out(v); \}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00197}00197 }
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00198}00198 \textcolor{keyword}{static} \textcolor{keywordtype}{void} outliterals(stb\_uchar *in, \textcolor{keywordtype}{int} numlit)}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00199}00199 \{}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00200}00200     \textcolor{keywordflow}{while} (numlit > 65536) \{}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00201}00201         outliterals(in,65536);}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00202}00202         in     += 65536;}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00203}00203         numlit -\/= 65536;}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00204}00204     \}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00205}00205 }
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00206}00206     \textcolor{keywordflow}{if}      (numlit ==     0)    ;}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00207}00207     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (numlit <=    32)    stb\_out (0x000020 + numlit-\/1);}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00208}00208     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (numlit <=  2048)    stb\_out2(0x000800 + numlit-\/1);}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00209}00209     \textcolor{keywordflow}{else} \textcolor{comment}{/*  numlit <= 65536) */} stb\_out3(0x070000 + numlit-\/1);}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00210}00210 }
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00211}00211     \textcolor{keywordflow}{if} (stb\_\_out) \{}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00212}00212         memcpy(stb\_\_out,in,numlit);}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00213}00213         stb\_\_out += numlit;}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00214}00214     \} \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00215}00215         fwrite(in, 1, numlit, stb\_\_outfile);}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00216}00216 \}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00217}00217 }
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00218}00218 \textcolor{keyword}{static} \textcolor{keywordtype}{int} stb\_\_window = 0x40000; \textcolor{comment}{// 256K}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00219}00219 }
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00220}00220 \textcolor{keyword}{static} \textcolor{keywordtype}{int} stb\_not\_crap(\textcolor{keywordtype}{int} best, \textcolor{keywordtype}{int} dist)}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00221}00221 \{}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00222}00222     \textcolor{keywordflow}{return}   ((best > 2  \&\&  dist <= 0x00100)}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00223}00223         || (best > 5  \&\&  dist <= 0x04000)}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00224}00224         || (best > 7  \&\&  dist <= 0x80000));}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00225}00225 \}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00226}00226 }
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00227}00227 \textcolor{keyword}{static}  stb\_uint stb\_\_hashsize = 32768;}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00228}00228 }
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00229}00229 \textcolor{comment}{// note that you can play with the hashing functions all you}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00230}00230 \textcolor{comment}{// want without needing to change the decompressor}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00231}00231 \textcolor{preprocessor}{\#define stb\_\_hc(q,h,c)      (((h) << 7) + ((h) >> 25) + q[c])}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00232}00232 \textcolor{preprocessor}{\#define stb\_\_hc2(q,h,c,d)   (((h) << 14) + ((h) >> 18) + (q[c] << 7) + q[d])}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00233}00233 \textcolor{preprocessor}{\#define stb\_\_hc3(q,c,d,e)   ((q[c] << 14) + (q[d] << 7) + q[e])}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00234}00234 }
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00235}00235 \textcolor{keyword}{static} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} stb\_\_running\_adler;}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00236}00236 }
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00237}00237 \textcolor{keyword}{static} \textcolor{keywordtype}{int} stb\_compress\_chunk(stb\_uchar *history,}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00238}00238     stb\_uchar *start,}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00239}00239     stb\_uchar *end,}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00240}00240     \textcolor{keywordtype}{int} length,}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00241}00241     \textcolor{keywordtype}{int} *pending\_literals,}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00242}00242     stb\_uchar **chash,}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00243}00243     stb\_uint \mbox{\hyperlink{structmask}{mask}})}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00244}00244 \{}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00245}00245     (void)history;}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00246}00246     \textcolor{keywordtype}{int} window = stb\_\_window;}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00247}00247     stb\_uint match\_max;}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00248}00248     stb\_uchar *lit\_start = start -\/ *pending\_literals;}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00249}00249     stb\_uchar *q = start;}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00250}00250 }
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00251}00251 \textcolor{preprocessor}{\#define STB\_\_SCRAMBLE(h)   (((h) + ((h) >> 16)) \& mask)}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00252}00252 }
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00253}00253     \textcolor{comment}{// stop short of the end so we don't scan off the end doing}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00254}00254     \textcolor{comment}{// the hashing; this means we won't compress the last few bytes}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00255}00255     \textcolor{comment}{// unless they were part of something longer}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00256}00256     \textcolor{keywordflow}{while} (q < start+length \&\& q+12 < end) \{}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00257}00257         \textcolor{keywordtype}{int} m;}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00258}00258         stb\_uint h1,h2,h3,h4, h;}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00259}00259         stb\_uchar *t;}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00260}00260         \textcolor{keywordtype}{int} best = 2, dist=0;}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00261}00261 }
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00262}00262         \textcolor{keywordflow}{if} (q+65536 > end)}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00263}00263             match\_max = end-\/q;}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00264}00264         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00265}00265             match\_max = 65536;}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00266}00266 }
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00267}00267 \textcolor{preprocessor}{\#define stb\_\_nc(b,d)  ((d) <= window \&\& ((b) > 9 || stb\_not\_crap(b,d)))}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00268}00268 }
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00269}00269 \textcolor{preprocessor}{\#define STB\_\_TRY(t,p)  }\textcolor{comment}{/* avoid retrying a match we already tried */}\textcolor{preprocessor}{ \(\backslash\)}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00270}00270 \textcolor{preprocessor}{    if (p ? dist != q-\/t : 1)                             \(\backslash\)}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00271}00271 \textcolor{preprocessor}{    if ((m = stb\_matchlen(t, q, match\_max)) > best)     \(\backslash\)}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00272}00272 \textcolor{preprocessor}{    if (stb\_\_nc(m,q-\/(t)))                                \(\backslash\)}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00273}00273 \textcolor{preprocessor}{    best = m, dist = q -\/ (t)}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00274}00274 }
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00275}00275         \textcolor{comment}{// rather than search for all matches, only try 4 candidate locations,}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00276}00276         \textcolor{comment}{// chosen based on 4 different hash functions of different lengths.}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00277}00277         \textcolor{comment}{// this strategy is inspired by LZO; hashing is unrolled here using the}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00278}00278         \textcolor{comment}{// 'hc' macro}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00279}00279         h = stb\_\_hc3(q,0, 1, 2); h1 = STB\_\_SCRAMBLE(h);}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00280}00280         t = chash[h1]; \textcolor{keywordflow}{if} (t) STB\_\_TRY(t,0);}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00281}00281         h = stb\_\_hc2(q,h, 3, 4); h2 = STB\_\_SCRAMBLE(h);}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00282}00282         h = stb\_\_hc2(q,h, 5, 6);        t = chash[h2]; \textcolor{keywordflow}{if} (t) STB\_\_TRY(t,1);}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00283}00283         h = stb\_\_hc2(q,h, 7, 8); h3 = STB\_\_SCRAMBLE(h);}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00284}00284         h = stb\_\_hc2(q,h, 9,10);        t = chash[h3]; \textcolor{keywordflow}{if} (t) STB\_\_TRY(t,1);}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00285}00285         h = stb\_\_hc2(q,h,11,12); h4 = STB\_\_SCRAMBLE(h);}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00286}00286         t = chash[h4]; \textcolor{keywordflow}{if} (t) STB\_\_TRY(t,1);}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00287}00287 }
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00288}00288         \textcolor{comment}{// because we use a shared hash table, can only update it}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00289}00289         \textcolor{comment}{// \_after\_ we've probed all of them}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00290}00290         chash[h1] = chash[h2] = chash[h3] = chash[h4] = q;}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00291}00291 }
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00292}00292         \textcolor{keywordflow}{if} (best > 2)}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00293}00293             assert(dist > 0);}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00294}00294 }
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00295}00295         \textcolor{comment}{// see if our best match qualifies}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00296}00296         \textcolor{keywordflow}{if} (best < 3) \{ \textcolor{comment}{// fast path literals}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00297}00297             ++q;}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00298}00298         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (best > 2  \&\&  best <= 0x80    \&\&  dist <= 0x100) \{}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00299}00299             outliterals(lit\_start, q-\/lit\_start); lit\_start = (q += best);}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00300}00300             stb\_out(0x80 + best-\/1);}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00301}00301             stb\_out(dist-\/1);}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00302}00302         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (best > 5  \&\&  best <= 0x100   \&\&  dist <= 0x4000) \{}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00303}00303             outliterals(lit\_start, q-\/lit\_start); lit\_start = (q += best);}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00304}00304             stb\_out2(0x4000 + dist-\/1);}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00305}00305             stb\_out(best-\/1);}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00306}00306         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (best > 7  \&\&  best <= 0x100   \&\&  dist <= 0x80000) \{}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00307}00307             outliterals(lit\_start, q-\/lit\_start); lit\_start = (q += best);}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00308}00308             stb\_out3(0x180000 + dist-\/1);}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00309}00309             stb\_out(best-\/1);}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00310}00310         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (best > 8  \&\&  best <= 0x10000 \&\&  dist <= 0x80000) \{}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00311}00311             outliterals(lit\_start, q-\/lit\_start); lit\_start = (q += best);}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00312}00312             stb\_out3(0x100000 + dist-\/1);}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00313}00313             stb\_out2(best-\/1);}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00314}00314         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (best > 9                      \&\&  dist <= 0x1000000) \{}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00315}00315             \textcolor{keywordflow}{if} (best > 65536) best = 65536;}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00316}00316             outliterals(lit\_start, q-\/lit\_start); lit\_start = (q += best);}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00317}00317             \textcolor{keywordflow}{if} (best <= 0x100) \{}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00318}00318                 stb\_out(0x06);}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00319}00319                 stb\_out3(dist-\/1);}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00320}00320                 stb\_out(best-\/1);}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00321}00321             \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00322}00322                 stb\_out(0x04);}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00323}00323                 stb\_out3(dist-\/1);}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00324}00324                 stb\_out2(best-\/1);}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00325}00325             \}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00326}00326         \} \textcolor{keywordflow}{else} \{  \textcolor{comment}{// fallback literals if no match was a balanced tradeoff}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00327}00327             ++q;}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00328}00328         \}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00329}00329     \}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00330}00330 }
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00331}00331     \textcolor{comment}{// if we didn't get all the way, add the rest to literals}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00332}00332     \textcolor{keywordflow}{if} (q-\/start < length)}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00333}00333         q = start+length;}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00334}00334 }
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00335}00335     \textcolor{comment}{// the literals are everything from lit\_start to q}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00336}00336     *pending\_literals = (q -\/ lit\_start);}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00337}00337 }
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00338}00338     stb\_\_running\_adler = stb\_adler32(stb\_\_running\_adler, start, q -\/ start);}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00339}00339     \textcolor{keywordflow}{return} q -\/ start;}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00340}00340 \}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00341}00341 }
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00342}00342 \textcolor{keyword}{static} \textcolor{keywordtype}{int} stb\_compress\_inner(stb\_uchar *input, stb\_uint length)}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00343}00343 \{}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00344}00344     \textcolor{keywordtype}{int} literals = 0;}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00345}00345     stb\_uint len,i;}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00346}00346 }
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00347}00347     stb\_uchar **chash;}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00348}00348     chash = (stb\_uchar**) malloc(stb\_\_hashsize * \textcolor{keyword}{sizeof}(stb\_uchar*));}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00349}00349     \textcolor{keywordflow}{if} (chash == NULL) \textcolor{keywordflow}{return} 0; \textcolor{comment}{// failure}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00350}00350     \textcolor{keywordflow}{for} (i=0; i < stb\_\_hashsize; ++i)}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00351}00351         chash[i] = NULL;}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00352}00352 }
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00353}00353     \textcolor{comment}{// stream signature}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00354}00354     stb\_out(0x57); stb\_out(0xbc);}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00355}00355     stb\_out2(0);}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00356}00356 }
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00357}00357     stb\_out4(0);       \textcolor{comment}{// 64-\/bit length requires 32-\/bit leading 0}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00358}00358     stb\_out4(length);}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00359}00359     stb\_out4(stb\_\_window);}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00360}00360 }
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00361}00361     stb\_\_running\_adler = 1;}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00362}00362 }
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00363}00363     len = stb\_compress\_chunk(input, input, input+length, length, \&literals, chash, stb\_\_hashsize-\/1);}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00364}00364     assert(len == length);}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00365}00365 }
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00366}00366     outliterals(input+length -\/ literals, literals);}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00367}00367 }
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00368}00368     free(chash);}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00369}00369 }
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00370}00370     stb\_out2(0x05fa); \textcolor{comment}{// end opcode}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00371}00371 }
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00372}00372     stb\_out4(stb\_\_running\_adler);}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00373}00373 }
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00374}00374     \textcolor{keywordflow}{return} 1; \textcolor{comment}{// success}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00375}00375 \}}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00376}00376 }
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00377}00377 stb\_uint stb\_compress(stb\_uchar *out, stb\_uchar *input, stb\_uint length)}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00378}00378 \{}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00379}00379     stb\_\_out = out;}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00380}00380     stb\_\_outfile = NULL;}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00381}00381 }
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00382}00382     stb\_compress\_inner(input, length);}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00383}00383 }
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00384}00384     \textcolor{keywordflow}{return} stb\_\_out -\/ out;}
\DoxyCodeLine{\Hypertarget{binary__to__compressed__c_8cpp_source_l00385}00385 \}}

\end{DoxyCode}
