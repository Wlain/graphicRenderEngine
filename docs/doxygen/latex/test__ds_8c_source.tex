\hypertarget{test__ds_8c_source}{}\doxysection{test\+\_\+ds.\+c}
\label{test__ds_8c_source}\index{/Users/cwb/developer/learning/graphicRenderEngine/ceres/3rdparty/stb/tests/test\_ds.c@{/Users/cwb/developer/learning/graphicRenderEngine/ceres/3rdparty/stb/tests/test\_ds.c}}

\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00001}00001 \textcolor{preprocessor}{\#ifdef DS\_PERF}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00002}00002 \textcolor{preprocessor}{\#define \_CRT\_SECURE\_NO\_WARNINGS}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00003}00003 \textcolor{preprocessor}{\#define \_CRT\_NONSTDC\_NO\_DEPRECATE}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00004}00004 \textcolor{preprocessor}{\#define \_CRT\_NON\_CONFORMING\_SWPRINTFS}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00005}00005 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00006}00006 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00007}00007 \textcolor{comment}{//\#define STBDS\_INTERNAL\_SMALL\_BUCKET    // make 64-\/bit bucket fit both keys and hash bits}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00008}00008 \textcolor{comment}{//\#define STBDS\_SIPHASH\_2\_4     // performance test 1\_3 against 2\_4}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00009}00009 \textcolor{comment}{//\#define STBDS\_INTERNAL\_BUCKET\_START    // don't bother offseting differently within bucket for different hash values}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00010}00010 \textcolor{comment}{//\#define STBDS\_FLUSH\_CACHE  (1u<<20) // do this much memory traffic to flush the cache between some benchmarking measurements}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00011}00011 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00012}00012 \textcolor{preprocessor}{\#include <stdio.h>}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00013}00013 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00014}00014 \textcolor{preprocessor}{\#define WIN32\_LEAN\_AND\_MEAN}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00015}00015 \textcolor{preprocessor}{\#include <windows.h>}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00016}00016 \textcolor{preprocessor}{\#define STB\_DEFINE}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00017}00017 \textcolor{preprocessor}{\#define STB\_NO\_REGISTRY}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00018}00018 \textcolor{preprocessor}{\#include "{}../stb.h"{}}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00019}00019 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00020}00020 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00021}00021 \textcolor{preprocessor}{\#ifdef DS\_TEST}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00022}00022 \textcolor{preprocessor}{\#define STBDS\_UNIT\_TESTS}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00023}00023 \textcolor{preprocessor}{\#define STBDS\_SMALL\_BUCKET}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00024}00024 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00025}00025 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00026}00026 \textcolor{preprocessor}{\#ifdef DS\_STATS}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00027}00027 \textcolor{preprocessor}{\#define STBDS\_STATISTICS}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00028}00028 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00029}00029 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00030}00030 \textcolor{preprocessor}{\#ifndef DS\_PERF}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00031}00031 \textcolor{preprocessor}{\#define STBDS\_ASSERT assert}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00032}00032 \textcolor{preprocessor}{\#include <assert.h>}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00033}00033 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00034}00034 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00035}00035 \textcolor{preprocessor}{\#define STB\_DS\_IMPLEMENTATION}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00036}00036 \textcolor{preprocessor}{\#include "{}../stb\_ds.h"{}}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00037}00037 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00038}00038 \textcolor{keywordtype}{size\_t} churn\_inserts, churn\_deletes;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00039}00039 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00040}00040 \textcolor{keywordtype}{void} churn(\textcolor{keywordtype}{int} a, \textcolor{keywordtype}{int} b, \textcolor{keywordtype}{int} count)}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00041}00041 \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00042}00042   \textcolor{keyword}{struct }\{ \textcolor{keywordtype}{int} key,\mbox{\hyperlink{classvalue}{value}}; \} *map=NULL;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00043}00043   \textcolor{keywordtype}{int} i,j,n,k;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00044}00044   \textcolor{keywordflow}{for} (i=0; i < a; ++i)}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00045}00045     hmput(map,i,i+1);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00046}00046   \textcolor{keywordflow}{for} (n=0; n < count; ++n) \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00047}00047     \textcolor{keywordflow}{for} (j=a; j < b; ++j,++i) \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00048}00048       hmput(map,i,i+1);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00049}00049     \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00050}00050     assert(hmlen(map) == b);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00051}00051     \textcolor{keywordflow}{for} (j=a; j < b; ++j) \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00052}00052       k=i-\/j-\/1;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00053}00053       k = hmdel(map,k);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00054}00054       assert(k != 0);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00055}00055     \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00056}00056     assert(hmlen(map) == a);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00057}00057   \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00058}00058   hmfree(map);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00059}00059   churn\_inserts = i;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00060}00060   churn\_deletes = (b-\/a) * n;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00061}00061 \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00062}00062 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00063}00063 \textcolor{preprocessor}{\#ifdef DS\_TEST}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00064}00064 \textcolor{preprocessor}{\#include <stdio.h>}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00065}00065 \textcolor{keywordtype}{int} main(\textcolor{keywordtype}{int} argc, \textcolor{keywordtype}{char} **argv)}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00066}00066 \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00067}00067   \textcolor{keywordtype}{char} *temp=NULL;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00068}00068   stbds\_unit\_tests();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00069}00069   arrins(temp, 0, \textcolor{charliteral}{'a'});}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00070}00070   arrins(temp, arrlen(temp), \textcolor{charliteral}{'b'});}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00071}00071   churn(0,100,1);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00072}00072   churn(3,7,50000);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00073}00073   churn(3,15,50000);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00074}00074   churn(16, 48, 25000);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00075}00075   churn(10, 15, 25000);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00076}00076   churn(200,500, 5000);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00077}00077   churn(2000,5000, 500);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00078}00078   churn(20000,50000, 50);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00079}00079   printf(\textcolor{stringliteral}{"{}Ok!"{}});}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00080}00080   \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00081}00081 \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00082}00082 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00083}00083 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00084}00084 \textcolor{preprocessor}{\#ifdef DS\_STATS}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00085}00085 \textcolor{preprocessor}{\#define MAX(a,b) ((a) > (b) ? (a) : (b))}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00086}00086 \textcolor{keywordtype}{size\_t} max\_hit\_probes, max\_miss\_probes, total\_put\_probes, total\_miss\_probes, churn\_misses;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00087}00087 \textcolor{keywordtype}{void} churn\_stats(\textcolor{keywordtype}{int} a, \textcolor{keywordtype}{int} b, \textcolor{keywordtype}{int} count)}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00088}00088 \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00089}00089   \textcolor{keyword}{struct }\{ \textcolor{keywordtype}{int} key,\mbox{\hyperlink{classvalue}{value}}; \} *map=NULL;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00090}00090   \textcolor{keywordtype}{int} i,j,n,k;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00091}00091   churn\_misses = 0;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00092}00092   \textcolor{keywordflow}{for} (i=0; i < a; ++i) \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00093}00093     hmput(map,i,i+1);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00094}00094     max\_hit\_probes = MAX(max\_hit\_probes, stbds\_hash\_probes);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00095}00095     total\_put\_probes += stbds\_hash\_probes;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00096}00096     stbds\_hash\_probes = 0;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00097}00097   \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00098}00098     }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00099}00099   \textcolor{keywordflow}{for} (n=0; n < count; ++n) \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00100}00100     \textcolor{keywordflow}{for} (j=a; j < b; ++j,++i) \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00101}00101       hmput(map,i,i+1);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00102}00102       max\_hit\_probes = MAX(max\_hit\_probes, stbds\_hash\_probes);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00103}00103       total\_put\_probes += stbds\_hash\_probes;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00104}00104       stbds\_hash\_probes = 0;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00105}00105     \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00106}00106     \textcolor{keywordflow}{for} (j=0; j < (b-\/a)*10; ++j) \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00107}00107       k=i+j;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00108}00108       (void) hmgeti(map,k); \textcolor{comment}{// miss}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00109}00109       max\_miss\_probes = MAX(max\_miss\_probes, stbds\_hash\_probes);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00110}00110       total\_miss\_probes += stbds\_hash\_probes;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00111}00111       stbds\_hash\_probes = 0;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00112}00112       ++churn\_misses;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00113}00113     \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00114}00114     assert(hmlen(map) == b);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00115}00115     \textcolor{keywordflow}{for} (j=a; j < b; ++j) \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00116}00116       k=i-\/j-\/1;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00117}00117       k = hmdel(map,k);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00118}00118       stbds\_hash\_probes = 0;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00119}00119       assert(k);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00120}00120     \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00121}00121     assert(hmlen(map) == a);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00122}00122   \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00123}00123   hmfree(map);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00124}00124   churn\_inserts = i;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00125}00125   churn\_deletes = (b-\/a) * n;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00126}00126 \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00127}00127 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00128}00128 \textcolor{keywordtype}{void} reset\_stats(\textcolor{keywordtype}{void})}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00129}00129 \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00130}00130   stbds\_array\_grow=0, }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00131}00131   stbds\_hash\_grow=0;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00132}00132   stbds\_hash\_shrink=0;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00133}00133   stbds\_hash\_rebuild=0;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00134}00134   stbds\_hash\_probes=0;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00135}00135   stbds\_hash\_alloc=0;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00136}00136   stbds\_rehash\_probes=0;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00137}00137   stbds\_rehash\_items=0;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00138}00138   max\_hit\_probes = 0;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00139}00139   max\_miss\_probes = 0;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00140}00140   total\_put\_probes = 0;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00141}00141   total\_miss\_probes = 0;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00142}00142 \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00143}00143 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00144}00144 \textcolor{keywordtype}{void} print\_churn\_probe\_stats(\textcolor{keywordtype}{char} *str)}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00145}00145 \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00146}00146   printf(\textcolor{stringliteral}{"{}Probes: \%3d max hit, \%3d max miss, \%4.2f avg hit, \%4.2f avg miss: \%s\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00147}00147     (\textcolor{keywordtype}{int}) max\_hit\_probes, (\textcolor{keywordtype}{int}) max\_miss\_probes, (\textcolor{keywordtype}{float}) total\_put\_probes / churn\_inserts, (\textcolor{keywordtype}{float}) total\_miss\_probes / churn\_misses, str);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00148}00148   reset\_stats();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00149}00149 \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00150}00150 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00151}00151 \textcolor{keywordtype}{int} main(\textcolor{keywordtype}{int} arg, \textcolor{keywordtype}{char} **argv)}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00152}00152 \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00153}00153   churn\_stats(0,500000,1); print\_churn\_probe\_stats(\textcolor{stringliteral}{"{}Inserting 500000 items"{}});}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00154}00154   churn\_stats(0,500000,1); print\_churn\_probe\_stats(\textcolor{stringliteral}{"{}Inserting 500000 items"{}});}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00155}00155   churn\_stats(0,500000,1); print\_churn\_probe\_stats(\textcolor{stringliteral}{"{}Inserting 500000 items"{}});}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00156}00156   churn\_stats(0,500000,1); print\_churn\_probe\_stats(\textcolor{stringliteral}{"{}Inserting 500000 items"{}});}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00157}00157   churn\_stats(49000,50000,500); print\_churn\_probe\_stats(\textcolor{stringliteral}{"{}Deleting/Inserting 500000 items"{}});}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00158}00158   churn\_stats(49000,50000,500); print\_churn\_probe\_stats(\textcolor{stringliteral}{"{}Deleting/Inserting 500000 items"{}});}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00159}00159   churn\_stats(49000,50000,500); print\_churn\_probe\_stats(\textcolor{stringliteral}{"{}Deleting/Inserting 500000 items"{}});}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00160}00160   churn\_stats(49000,50000,500); print\_churn\_probe\_stats(\textcolor{stringliteral}{"{}Deleting/Inserting 500000 items"{}});}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00161}00161   \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00162}00162 \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00163}00163 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00164}00164 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00165}00165 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00166}00166 \textcolor{preprocessor}{\#ifdef DS\_PERF}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00167}00167 \textcolor{comment}{//char *strdup(const char *foo) \{ return 0; \}}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00168}00168 \textcolor{comment}{//int stricmp(const char *a, const char *b) \{ return 0; \}}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00169}00169 \textcolor{comment}{//int strnicmp(const char *a, const char *b, size\_t n) \{ return 0; \}}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00170}00170 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00171}00171 \textcolor{keywordtype}{unsigned} \_\_int64 t0, xsum, mn,mx,count;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00172}00172 \textcolor{keywordtype}{void} begin(\textcolor{keywordtype}{void})}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00173}00173 \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00174}00174   LARGE\_INTEGER m;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00175}00175   QueryPerformanceCounter(\&m);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00176}00176   t0 = m.QuadPart;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00177}00177   xsum = 0;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00178}00178   count = 0;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00179}00179   mx = 0;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00180}00180   mn = \string~(\textcolor{keywordtype}{unsigned} \_\_int64) 0;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00181}00181 \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00182}00182 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00183}00183 \textcolor{keywordtype}{void} measure(\textcolor{keywordtype}{void})}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00184}00184 \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00185}00185   \textcolor{keywordtype}{unsigned} \_\_int64 t1, t;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00186}00186   LARGE\_INTEGER m;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00187}00187   QueryPerformanceCounter(\&m);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00188}00188   t1 = m.QuadPart;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00189}00189   t = t1-\/t0;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00190}00190   \textcolor{keywordflow}{if} (t1 < t0)}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00191}00191     printf(\textcolor{stringliteral}{"{}ALERT: QueryPerformanceCounter was unordered!\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00192}00192   \textcolor{keywordflow}{if} (t < mn) mn = t;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00193}00193   \textcolor{keywordflow}{if} (t > mx) mx = t;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00194}00194   xsum += t;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00195}00195   ++count;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00196}00196   t0 = t1;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00197}00197 \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00198}00198 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00199}00199 \textcolor{keywordtype}{void} dont\_measure(\textcolor{keywordtype}{void})}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00200}00200 \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00201}00201   LARGE\_INTEGER m;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00202}00202   QueryPerformanceCounter(\&m);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00203}00203   t0 = m.QuadPart;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00204}00204 \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00205}00205 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00206}00206 \textcolor{keywordtype}{double} timer;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00207}00207 \textcolor{keywordtype}{double} end(\textcolor{keywordtype}{void})}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00208}00208 \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00209}00209   LARGE\_INTEGER m;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00210}00210   QueryPerformanceFrequency(\&m);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00211}00211 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00212}00212   \textcolor{keywordflow}{if} (count > 3) \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00213}00213     \textcolor{comment}{// discard the highest and lowest}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00214}00214     xsum -\/= mn;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00215}00215     xsum -\/= mx;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00216}00216     count -\/= 2;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00217}00217   \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00218}00218   timer = (double) (xsum) / count / m.QuadPart * 1000;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00219}00219   \textcolor{keywordflow}{return} timer;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00220}00220 \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00221}00221 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00222}00222 \textcolor{keywordtype}{void} build(\textcolor{keywordtype}{int} a, \textcolor{keywordtype}{int} b, \textcolor{keywordtype}{int} count, \textcolor{keywordtype}{int} \mbox{\hyperlink{group__core__func__common_ga015a1261ff23e12650211aa872863cce}{step}})}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00223}00223 \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00224}00224   \textcolor{keyword}{struct }\{ \textcolor{keywordtype}{int} key,\mbox{\hyperlink{classvalue}{value}}; \} *map=NULL;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00225}00225   \textcolor{keywordtype}{int} i,n;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00226}00226   \textcolor{keywordflow}{for} (i=0; i < a; ++i) \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00227}00227     n = i*\mbox{\hyperlink{group__core__func__common_ga015a1261ff23e12650211aa872863cce}{step}};}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00228}00228     hmput(map,n,i+1);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00229}00229   \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00230}00230   measure();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00231}00231   churn\_inserts = i;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00232}00232   hmfree(map);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00233}00233   dont\_measure();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00234}00234 \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00235}00235 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00236}00236 \textcolor{preprocessor}{\#ifdef STB\_\_INCLUDE\_STB\_H}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00237}00237 \textcolor{keywordtype}{void} build\_stb(\textcolor{keywordtype}{int} a, \textcolor{keywordtype}{int} b, \textcolor{keywordtype}{int} count, \textcolor{keywordtype}{int} \mbox{\hyperlink{group__core__func__common_ga015a1261ff23e12650211aa872863cce}{step}})}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00238}00238 \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00239}00239   stb\_idict *d = stb\_idict\_new\_size(8);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00240}00240   \textcolor{keywordtype}{int} i;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00241}00241   \textcolor{keywordflow}{for} (i=0; i < a; ++i)}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00242}00242     stb\_idict\_add(d, i*\mbox{\hyperlink{group__core__func__common_ga015a1261ff23e12650211aa872863cce}{step}}, i+1);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00243}00243   measure();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00244}00244   churn\_inserts = i;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00245}00245   stb\_idict\_destroy(d);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00246}00246   dont\_measure();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00247}00247 \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00248}00248 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00249}00249 \textcolor{keywordtype}{void} multibuild\_stb(\textcolor{keywordtype}{int} a, \textcolor{keywordtype}{int} b, \textcolor{keywordtype}{int} count, \textcolor{keywordtype}{int} \mbox{\hyperlink{group__core__func__common_ga015a1261ff23e12650211aa872863cce}{step}}, \textcolor{keywordtype}{int} tables)}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00250}00250 \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00251}00251   stb\_idict *d[50000];}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00252}00252   \textcolor{keywordtype}{int} i,q;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00253}00253   \textcolor{keywordflow}{for} (q=0; q < tables; ++q)}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00254}00254     d[q] = stb\_idict\_new\_size(8);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00255}00255   dont\_measure();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00256}00256   \textcolor{keywordflow}{for} (i=0; i < a; ++i)}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00257}00257     \textcolor{keywordflow}{for} (q=0; q < tables; ++q)}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00258}00258       stb\_idict\_add(d[q], i*\mbox{\hyperlink{group__core__func__common_ga015a1261ff23e12650211aa872863cce}{step}}+q*771, i+1);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00259}00259   measure();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00260}00260   churn\_inserts = i;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00261}00261   \textcolor{keywordflow}{for} (q=0; q < tables; ++q)}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00262}00262     stb\_idict\_destroy(d[q]);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00263}00263   dont\_measure();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00264}00264 \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00265}00265 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00266}00266 \textcolor{keywordtype}{int} multisearch\_stb(\textcolor{keywordtype}{int} a, \textcolor{keywordtype}{int} start, \textcolor{keywordtype}{int} end, \textcolor{keywordtype}{int} \mbox{\hyperlink{group__core__func__common_ga015a1261ff23e12650211aa872863cce}{step}}, \textcolor{keywordtype}{int} tables)}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00267}00267 \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00268}00268   stb\_idict *d[50000];}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00269}00269   \textcolor{keywordtype}{int} i,q,total=0,v;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00270}00270   \textcolor{keywordflow}{for} (q=0; q < tables; ++q)}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00271}00271     d[q] = stb\_idict\_new\_size(8);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00272}00272   \textcolor{keywordflow}{for} (q=0; q < tables; ++q)}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00273}00273     \textcolor{keywordflow}{for} (i=0; i < a; ++i)}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00274}00274       stb\_idict\_add(d[q], i*\mbox{\hyperlink{group__core__func__common_ga015a1261ff23e12650211aa872863cce}{step}}+q*771, i+1);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00275}00275   dont\_measure();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00276}00276   \textcolor{keywordflow}{for} (i=start; i < end; ++i)}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00277}00277     \textcolor{keywordflow}{for} (q=0; q < tables; ++q)}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00278}00278       \textcolor{keywordflow}{if} (stb\_idict\_get\_flag(d[q], i*\mbox{\hyperlink{group__core__func__common_ga015a1261ff23e12650211aa872863cce}{step}}+q*771, \&v))}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00279}00279         total += v;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00280}00280   measure();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00281}00281   churn\_inserts = i;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00282}00282   \textcolor{keywordflow}{for} (q=0; q < tables; ++q)}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00283}00283     stb\_idict\_destroy(d[q]);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00284}00284   dont\_measure();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00285}00285   \textcolor{keywordflow}{return} total;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00286}00286 \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00287}00287 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00288}00288 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00289}00289 \textcolor{keywordtype}{int} multisearch(\textcolor{keywordtype}{int} a, \textcolor{keywordtype}{int} start, \textcolor{keywordtype}{int} end, \textcolor{keywordtype}{int} \mbox{\hyperlink{group__core__func__common_ga015a1261ff23e12650211aa872863cce}{step}}, \textcolor{keywordtype}{int} tables)}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00290}00290 \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00291}00291   \textcolor{keyword}{struct }\{ \textcolor{keywordtype}{int} key,\mbox{\hyperlink{classvalue}{value}}; \} *hash[50000];}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00292}00292   \textcolor{keywordtype}{int} i,q,total=0;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00293}00293   \textcolor{keywordflow}{for} (q=0; q < tables; ++q)}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00294}00294     hash[q] = NULL;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00295}00295   \textcolor{keywordflow}{for} (q=0; q < tables; ++q)}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00296}00296     \textcolor{keywordflow}{for} (i=0; i < a; ++i)}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00297}00297       hmput(hash[q], i*\mbox{\hyperlink{group__core__func__common_ga015a1261ff23e12650211aa872863cce}{step}}+q*771, i+1);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00298}00298   dont\_measure();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00299}00299   \textcolor{keywordflow}{for} (i=start; i < end; ++i)}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00300}00300     \textcolor{keywordflow}{for} (q=0; q < tables; ++q)}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00301}00301       total += hmget(hash[q], i*\mbox{\hyperlink{group__core__func__common_ga015a1261ff23e12650211aa872863cce}{step}}+q*771);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00302}00302   measure();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00303}00303   churn\_inserts = i;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00304}00304   \textcolor{keywordflow}{for} (q=0; q < tables; ++q)}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00305}00305     hmfree(hash[q]);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00306}00306   dont\_measure();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00307}00307   \textcolor{keywordflow}{return} total;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00308}00308 \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00309}00309 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00310}00310 \textcolor{keywordtype}{void} churn\_skip(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} a, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} b, \textcolor{keywordtype}{int} count)}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00311}00311 \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00312}00312   \textcolor{keyword}{struct }\{ \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} key,\mbox{\hyperlink{classvalue}{value}}; \} *map=NULL;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00313}00313   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i,j,n,k;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00314}00314   \textcolor{keywordflow}{for} (i=0; i < a; ++i)}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00315}00315     hmput(map,i,i+1);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00316}00316   dont\_measure();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00317}00317   \textcolor{keywordflow}{for} (n=0; n < count; ++n) \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00318}00318     \textcolor{keywordflow}{for} (j=a; j < b; ++j,++i) \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00319}00319       hmput(map,i,i+1);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00320}00320     \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00321}00321     assert(hmlen(map) == b);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00322}00322     \textcolor{keywordflow}{for} (j=a; j < b; ++j) \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00323}00323       k=i-\/j-\/1;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00324}00324       k = hmdel(map,k);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00325}00325       assert(k != 0);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00326}00326     \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00327}00327     assert(hmlen(map) == a);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00328}00328   \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00329}00329   measure();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00330}00330   churn\_inserts = i;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00331}00331   churn\_deletes = (b-\/a) * n;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00332}00332   hmfree(map);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00333}00333   dont\_measure();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00334}00334 \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00335}00335 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00336}00336 \textcolor{keyword}{typedef} \textcolor{keyword}{struct }\{ \textcolor{keywordtype}{int} n[8]; \} str32;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00337}00337 \textcolor{keywordtype}{void} churn32(\textcolor{keywordtype}{int} a, \textcolor{keywordtype}{int} b, \textcolor{keywordtype}{int} count, \textcolor{keywordtype}{int} include\_startup)}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00338}00338 \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00339}00339   \textcolor{keyword}{struct }\{ str32 key; \textcolor{keywordtype}{int} \mbox{\hyperlink{classvalue}{value}}; \} *map=NULL;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00340}00340   \textcolor{keywordtype}{int} i,j,n;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00341}00341   str32 key = \{ 0 \};}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00342}00342   \textcolor{keywordflow}{for} (i=0; i < a; ++i) \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00343}00343     key.n[0] = i;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00344}00344     hmput(map,key,i+1);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00345}00345   \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00346}00346   \textcolor{keywordflow}{if} (!include\_startup)}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00347}00347     dont\_measure();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00348}00348   \textcolor{keywordflow}{for} (n=0; n < count; ++n) \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00349}00349     \textcolor{keywordflow}{for} (j=a; j < b; ++j,++i) \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00350}00350       key.n[0] = i;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00351}00351       hmput(map,key,i+1);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00352}00352     \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00353}00353     assert(hmlen(map) == b);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00354}00354     \textcolor{keywordflow}{for} (j=a; j < b; ++j) \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00355}00355       key.n[0] = i-\/j-\/1;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00356}00356       hmdel(map,key);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00357}00357     \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00358}00358     assert(hmlen(map) == a);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00359}00359   \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00360}00360   measure();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00361}00361   hmfree(map);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00362}00362   churn\_inserts = i;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00363}00363   churn\_deletes = (b-\/a) * n;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00364}00364   dont\_measure();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00365}00365 \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00366}00366 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00367}00367 \textcolor{keyword}{typedef} \textcolor{keyword}{struct }\{ \textcolor{keywordtype}{int} n[32]; \} str256;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00368}00368 \textcolor{keywordtype}{void} churn256(\textcolor{keywordtype}{int} a, \textcolor{keywordtype}{int} b, \textcolor{keywordtype}{int} count, \textcolor{keywordtype}{int} include\_startup)}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00369}00369 \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00370}00370   \textcolor{keyword}{struct }\{ str256 key; \textcolor{keywordtype}{int} \mbox{\hyperlink{classvalue}{value}}; \} *map=NULL;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00371}00371   \textcolor{keywordtype}{int} i,j,n;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00372}00372   str256 key = \{ 0 \};}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00373}00373   \textcolor{keywordflow}{for} (i=0; i < a; ++i) \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00374}00374     key.n[0] = i;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00375}00375     hmput(map,key,i+1);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00376}00376   \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00377}00377   \textcolor{keywordflow}{if} (!include\_startup)}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00378}00378     dont\_measure();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00379}00379   \textcolor{keywordflow}{for} (n=0; n < count; ++n) \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00380}00380     \textcolor{keywordflow}{for} (j=a; j < b; ++j,++i) \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00381}00381       key.n[0] = i;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00382}00382       hmput(map,key,i+1);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00383}00383     \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00384}00384     assert(hmlen(map) == b);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00385}00385     \textcolor{keywordflow}{for} (j=a; j < b; ++j) \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00386}00386       key.n[0] = i-\/j-\/1;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00387}00387       hmdel(map,key);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00388}00388     \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00389}00389     assert(hmlen(map) == a);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00390}00390   \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00391}00391   measure();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00392}00392   hmfree(map);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00393}00393   churn\_inserts = i;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00394}00394   churn\_deletes = (b-\/a) * n;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00395}00395   dont\_measure();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00396}00396 \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00397}00397 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00398}00398 \textcolor{keywordtype}{void} churn8(\textcolor{keywordtype}{int} a, \textcolor{keywordtype}{int} b, \textcolor{keywordtype}{int} count, \textcolor{keywordtype}{int} include\_startup)}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00399}00399 \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00400}00400   \textcolor{keyword}{struct }\{ \textcolor{keywordtype}{size\_t} key,\mbox{\hyperlink{classvalue}{value}}; \} *map=NULL;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00401}00401   \textcolor{keywordtype}{int} i,j,n,k;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00402}00402   \textcolor{keywordflow}{for} (i=0; i < a; ++i)}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00403}00403     hmput(map,i,i+1);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00404}00404   \textcolor{keywordflow}{if} (!include\_startup)}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00405}00405     dont\_measure();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00406}00406   \textcolor{keywordflow}{for} (n=0; n < count; ++n) \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00407}00407     \textcolor{keywordflow}{for} (j=a; j < b; ++j,++i) \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00408}00408       hmput(map,i,i+1);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00409}00409     \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00410}00410     assert(hmlen(map) == b);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00411}00411     \textcolor{keywordflow}{for} (j=a; j < b; ++j) \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00412}00412       k=i-\/j-\/1;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00413}00413       k = hmdel(map,k);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00414}00414       assert(k != 0);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00415}00415     \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00416}00416     assert(hmlen(map) == a);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00417}00417   \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00418}00418   measure();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00419}00419   hmfree(map);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00420}00420   churn\_inserts = i;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00421}00421   churn\_deletes = (b-\/a) * n;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00422}00422   dont\_measure();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00423}00423 \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00424}00424 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00425}00425 \textcolor{keywordtype}{void} multichurn4(\textcolor{keywordtype}{int} a, \textcolor{keywordtype}{int} b, \textcolor{keywordtype}{int} count, \textcolor{keywordtype}{int} include\_startup, \textcolor{keywordtype}{int} tables)}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00426}00426 \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00427}00427   \textcolor{keyword}{struct }\{ \textcolor{keywordtype}{int} key,\mbox{\hyperlink{classvalue}{value}}; \} *map[50000];}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00428}00428   \textcolor{keywordtype}{int} i,j,n,k,q;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00429}00429   \textcolor{keywordflow}{for} (q=0; q < tables; ++q)}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00430}00430     map[q] = NULL;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00431}00431   dont\_measure();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00432}00432 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00433}00433   \textcolor{keywordflow}{for} (i=0; i < a; ++i)}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00434}00434     \textcolor{keywordflow}{for} (q=0; q < tables; ++q)}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00435}00435       hmput(map[q],i,i+1);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00436}00436   \textcolor{keywordflow}{if} (!include\_startup)}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00437}00437     dont\_measure();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00438}00438   \textcolor{keywordflow}{for} (n=0; n < count; ++n) \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00439}00439     \textcolor{keywordflow}{for} (j=a; j < b; ++j,++i) \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00440}00440       \textcolor{keywordflow}{for} (q=0; q < tables; ++q)}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00441}00441         hmput(map[q],i,i+1);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00442}00442     \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00443}00443     assert(hmlen(map[0]) == b);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00444}00444     \textcolor{keywordflow}{for} (j=a; j < b; ++j) \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00445}00445       k=i-\/j-\/1;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00446}00446       \textcolor{keywordflow}{for} (q=0; q < tables; ++q)}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00447}00447         k = hmdel(map[q],k);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00448}00448       assert(k != 0);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00449}00449     \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00450}00450     assert(hmlen(map[0]) == a);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00451}00451   \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00452}00452   measure();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00453}00453   \textcolor{keywordflow}{for} (q=0; q < tables; ++q)}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00454}00454     hmfree(map[q]);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00455}00455   churn\_inserts = i * tables;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00456}00456   churn\_deletes = (b-\/a) * n * tables;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00457}00457   dont\_measure();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00458}00458 \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00459}00459 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00460}00460 \textcolor{keyword}{struct }\{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00461}00461   \textcolor{keywordtype}{unsigned} \_\_int64 start;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00462}00462   \textcolor{keywordtype}{unsigned} \_\_int64 end;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00463}00463   \textcolor{keywordtype}{int}    table\_size;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00464}00464 \} mstats[32][4000];}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00465}00465 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00466}00466 \textcolor{keyword}{const} \textcolor{keywordtype}{int} first\_step = 64;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00467}00467 \textcolor{keyword}{const} \textcolor{keywordtype}{int} last\_step = 384-\/48; \textcolor{comment}{// 32M}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00468}00468 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00469}00469 \textcolor{keywordtype}{void} measure\_build4(\textcolor{keywordtype}{int} step\_log2)}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00470}00470 \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00471}00471   \textcolor{keywordtype}{double} length;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00472}00472   \textcolor{keywordtype}{int} i,j,k=0;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00473}00473   \textcolor{keywordtype}{int} \mbox{\hyperlink{group__core__func__common_ga015a1261ff23e12650211aa872863cce}{step}} = 1 << step\_log2;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00474}00474   \textcolor{keywordtype}{unsigned} \_\_int64 t0,t1;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00475}00475   \textcolor{keyword}{struct }\{ \textcolor{keywordtype}{int} key,\mbox{\hyperlink{classvalue}{value}}; \} *map=NULL;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00476}00476   \textcolor{keywordtype}{double} rdtsc\_scale;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00477}00477   begin();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00478}00478   t0 = \_\_rdtsc();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00479}00479 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00480}00480   mstats[0][0].start = \_\_rdtsc();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00481}00481   \textcolor{keywordflow}{for} (i=0; i < 256; ++i) \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00482}00482     hmput(map,k,k+1);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00483}00483     k += \mbox{\hyperlink{group__core__func__common_ga015a1261ff23e12650211aa872863cce}{step}};}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00484}00484   \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00485}00485   mstats[0][first\_step-\/1].end = \_\_rdtsc();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00486}00486   mstats[0][first\_step-\/1].table\_size = k >> step\_log2;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00487}00487   \textcolor{keywordflow}{for} (j=first\_step; j < last\_step; ++j) \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00488}00488     \textcolor{keywordflow}{for} (i=0; i < (1<<(j>>4)); ++i) \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00489}00489       hmput(map, k,k+1);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00490}00490       k += \mbox{\hyperlink{group__core__func__common_ga015a1261ff23e12650211aa872863cce}{step}};}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00491}00491     \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00492}00492     mstats[0][j].end = \_\_rdtsc();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00493}00493     mstats[0][j].table\_size = k >> step\_log2;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00494}00494   \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00495}00495   t1 = \_\_rdtsc();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00496}00496   measure();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00497}00497   hmfree(map);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00498}00498   length = end();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00499}00499   rdtsc\_scale = length / (t1-\/t0) * 1000;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00500}00500 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00501}00501   \textcolor{keywordflow}{for} (j=1; j < last\_step; ++j)}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00502}00502     mstats[0][j].start = mstats[0][0].start;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00503}00503   \textcolor{keywordflow}{for} (j=first\_step-\/1; j < last\_step; ++j) \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00504}00504     printf(\textcolor{stringliteral}{"{}\%12.4f,\%12d,\%12d,0,0,0\(\backslash\)n"{}}, (mstats[0][j].end -\/ mstats[0][j].start) * rdtsc\_scale, mstats[0][j].table\_size, mstats[0][j].table\_size);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00505}00505   \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00506}00506 \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00507}00507 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00508}00508 \textcolor{preprocessor}{\#ifdef STBDS\_FLUSH\_CACHE}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00509}00509 \textcolor{keyword}{static} \textcolor{keywordtype}{int} cache\_index;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00510}00510 \textcolor{keywordtype}{char} dummy[8][STBDS\_FLUSH\_CACHE];}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00511}00511 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00512}00512 \textcolor{keywordtype}{int} flush\_cache(\textcolor{keywordtype}{void})}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00513}00513 \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00514}00514   memmove(dummy[cache\_index],dummy[cache\_index]+1, \textcolor{keyword}{sizeof}(dummy[cache\_index])-\/1);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00515}00515   cache\_index = (cache\_index+1)\%8;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00516}00516   \textcolor{keywordflow}{return} dummy[cache\_index][0];}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00517}00517 \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00518}00518 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00519}00519 \textcolor{keywordtype}{int} flush\_cache(\textcolor{keywordtype}{void}) \{ \textcolor{keywordflow}{return} 0; \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00520}00520 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00521}00521 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00522}00522 \textcolor{keywordtype}{int} measure\_average\_lookup4(\textcolor{keywordtype}{int} step\_log2)}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00523}00523 \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00524}00524   \textcolor{keywordtype}{int} total;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00525}00525   \textcolor{keywordtype}{double} length;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00526}00526   \textcolor{keywordtype}{int} i,j,k=0,q;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00527}00527   \textcolor{keywordtype}{int} \mbox{\hyperlink{group__core__func__common_ga015a1261ff23e12650211aa872863cce}{step}} = 1 << step\_log2;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00528}00528   \textcolor{keywordtype}{unsigned} \_\_int64 t0,t1;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00529}00529   \textcolor{keyword}{struct }\{ \textcolor{keywordtype}{int} key,\mbox{\hyperlink{classvalue}{value}}; \} *map=NULL;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00530}00530   \textcolor{keywordtype}{double} rdtsc\_scale;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00531}00531   begin();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00532}00532   t0 = \_\_rdtsc();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00533}00533 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00534}00534   \textcolor{keywordflow}{for} (i=0; i < 128; ++i) \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00535}00535     hmput(map,k,k+1);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00536}00536     k += \mbox{\hyperlink{group__core__func__common_ga015a1261ff23e12650211aa872863cce}{step}};}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00537}00537   \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00538}00538   \textcolor{keywordflow}{for} (j=first\_step; j <= last\_step; ++j) \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00539}00539     total += flush\_cache();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00540}00540     mstats[0][j].start = \_\_rdtsc();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00541}00541     \textcolor{keywordflow}{for} (q=i=0; i < 50000; ++i) \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00542}00542        total += hmget(map, q); \textcolor{comment}{// hit}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00543}00543        \textcolor{keywordflow}{if} (++q == k) q = 0;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00544}00544     \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00545}00545     mstats[0][j].end = \_\_rdtsc();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00546}00546     mstats[0][j].table\_size = k;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00547}00547     total += flush\_cache();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00548}00548     mstats[1][j].start = \_\_rdtsc();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00549}00549     \textcolor{keywordflow}{for} (i=0; i < 50000; ++i) \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00550}00550        total += hmget(map, i+k); \textcolor{comment}{// miss}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00551}00551     \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00552}00552     mstats[1][j].end = \_\_rdtsc();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00553}00553     mstats[1][j].table\_size = k;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00554}00554 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00555}00555     \textcolor{comment}{// expand table}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00556}00556     \textcolor{keywordflow}{for} (i=0; i < (1<<(j>>4)); ++i) \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00557}00557       hmput(map, k,k+1);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00558}00558       k += \mbox{\hyperlink{group__core__func__common_ga015a1261ff23e12650211aa872863cce}{step}};}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00559}00559     \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00560}00560   \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00561}00561 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00562}00562   t1 = \_\_rdtsc();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00563}00563   measure();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00564}00564   hmfree(map);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00565}00565   length = end();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00566}00566   rdtsc\_scale = length / (t1-\/t0) * 1000;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00567}00567 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00568}00568   \textcolor{keywordflow}{for} (j=first\_step; j <= last\_step; ++j) \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00569}00569     \textcolor{comment}{// time,table\_size,numins,numhit,nummiss,numperflush}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00570}00570     printf(\textcolor{stringliteral}{"{}\%12.4f,\%12d,0,50000,0,0\(\backslash\)n"{}}, (mstats[0][j].end -\/ mstats[0][j].start) * rdtsc\_scale, mstats[0][j].table\_size);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00571}00571   \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00572}00572   \textcolor{keywordflow}{for} (j=first\_step; j <= last\_step; ++j) \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00573}00573     printf(\textcolor{stringliteral}{"{}\%12.4f,\%12d,0,0,50000,0\(\backslash\)n"{}}, (mstats[1][j].end -\/ mstats[1][j].start) * rdtsc\_scale, mstats[1][j].table\_size);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00574}00574   \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00575}00575   \textcolor{keywordflow}{return} total;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00576}00576 \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00577}00577 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00578}00578 \textcolor{keywordtype}{int} measure\_worst\_lookup4\_a(\textcolor{keywordtype}{int} step\_log2)}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00579}00579 \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00580}00580   \textcolor{keywordtype}{int} total;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00581}00581   \textcolor{keywordtype}{double} length;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00582}00582   \textcolor{keywordtype}{int} i,j,k=0,q,worst\_q,n,z,attempts;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00583}00583   \textcolor{keywordtype}{int} \mbox{\hyperlink{group__core__func__common_ga015a1261ff23e12650211aa872863cce}{step}} = 1 << step\_log2;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00584}00584   \textcolor{keywordtype}{unsigned} \_\_int64 t0,t1;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00585}00585   \textcolor{keywordtype}{unsigned} \_\_int64 m0,m1,worst;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00586}00586   \textcolor{keyword}{struct }\{ \textcolor{keywordtype}{int} key,\mbox{\hyperlink{classvalue}{value}}; \} *map=NULL;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00587}00587   \textcolor{keywordtype}{double} rdtsc\_scale;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00588}00588   begin();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00589}00589   t0 = \_\_rdtsc();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00590}00590 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00591}00591   memset(mstats, 0, \textcolor{keyword}{sizeof}(mstats));}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00592}00592   \textcolor{keywordflow}{for} (j=first\_step; j <= last\_step; ++j)}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00593}00593     mstats[0][j].end = mstats[1][j].end = \string~(\textcolor{keywordtype}{unsigned} \_\_int64) 0;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00594}00594 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00595}00595   \textcolor{keywordflow}{for}(attempts=0; attempts < 2; ++attempts) \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00596}00596     k = 0;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00597}00597     stbds\_rand\_seed(0); \textcolor{comment}{// force us to get the same table every time}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00598}00598     \textcolor{keywordflow}{for} (i=0; i < 128; ++i) \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00599}00599       hmput(map,k,k+1);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00600}00600       k += \mbox{\hyperlink{group__core__func__common_ga015a1261ff23e12650211aa872863cce}{step}};}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00601}00601     \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00602}00602     \textcolor{keywordflow}{for} (j=first\_step; j <= last\_step; ++j) \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00603}00603       \textcolor{keywordtype}{unsigned} \_\_int64 times[32];}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00604}00604 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00605}00605       \textcolor{comment}{// find the worst hit time}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00606}00606       \textcolor{keywordflow}{for} (z=0; z < 2; ++z) \{ \textcolor{comment}{// try the bisectioning measurement 4 times}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00607}00607         worst = 0;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00608}00608         \textcolor{keywordflow}{for} (n=0; n < 10; ++n) \{ \textcolor{comment}{// test 400 keys total}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00609}00609           \textcolor{comment}{// find the worst time to hit 20 keys}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00610}00610           q=0;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00611}00611           worst\_q = 0;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00612}00612           total += flush\_cache();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00613}00613           m0 = \_\_rdtsc();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00614}00614           \textcolor{keywordflow}{for} (i=0; i < 20; ++i) \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00615}00615             total += hmget(map, q); \textcolor{comment}{// hit}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00616}00616             \textcolor{keywordflow}{if} (++q == k) q = 0;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00617}00617           \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00618}00618           m1 = \_\_rdtsc();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00619}00619           \textcolor{comment}{// for each n, check if this is the worst lookup we've seen}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00620}00620           \textcolor{keywordflow}{if} (m1 -\/ m0 > worst) \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00621}00621             worst = m1-\/m0;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00622}00622             worst\_q = q -\/ i;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00623}00623             \textcolor{keywordflow}{if} (worst\_q < 0) q += k;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00624}00624           \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00625}00625         \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00626}00626         \textcolor{comment}{// after 400 keys, take the worst 20 keys, and try each one}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00627}00627         worst = 0;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00628}00628         q = worst\_q;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00629}00629         \textcolor{keywordflow}{for} (i=0; i < 20; ++i) \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00630}00630           total += flush\_cache();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00631}00631           m0 = \_\_rdtsc();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00632}00632           total += hmget(map, q); \textcolor{comment}{// hit}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00633}00633           m1 = \_\_rdtsc();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00634}00634           \textcolor{keywordflow}{if} (m1 -\/ m0 > worst)}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00635}00635             worst = m1-\/m0;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00636}00636           \textcolor{keywordflow}{if} (++q == k) q = 0;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00637}00637         \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00638}00638         times[z] = worst;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00639}00639       \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00640}00640       \textcolor{comment}{// find the worst time in the bunch}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00641}00641       worst = 0;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00642}00642       \textcolor{keywordflow}{for} (i=0; i < z; ++i)}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00643}00643         \textcolor{keywordflow}{if} (times[i] > worst)}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00644}00644           worst = times[i];}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00645}00645       \textcolor{comment}{// take the best of 'attempts', to discard outliers}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00646}00646       \textcolor{keywordflow}{if} (worst < mstats[0][j].end)}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00647}00647         mstats[0][j].end = worst;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00648}00648       mstats[0][j].start = 0;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00649}00649       mstats[0][j].table\_size = k >> step\_log2;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00650}00650 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00651}00651       \textcolor{comment}{// find the worst miss time}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00652}00652       \textcolor{keywordflow}{for} (z=0; z < 8; ++z) \{ \textcolor{comment}{// try the bisectioning measurement 8 times}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00653}00653         worst = 0;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00654}00654         \textcolor{keywordflow}{for} (n=0; n < 20; ++n) \{ \textcolor{comment}{// test 400 keys total}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00655}00655           \textcolor{comment}{// find the worst time to hit 20 keys}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00656}00656           q=k;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00657}00657           worst\_q = 0;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00658}00658           total += flush\_cache();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00659}00659           m0 = \_\_rdtsc();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00660}00660           \textcolor{keywordflow}{for} (i=0; i < 20; ++i) \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00661}00661             total += hmget(map, q); \textcolor{comment}{// hit}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00662}00662           \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00663}00663           m1 = \_\_rdtsc();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00664}00664           \textcolor{comment}{// for each n, check if this is the worst lookup we've seen}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00665}00665           \textcolor{keywordflow}{if} (m1 -\/ m0 > worst) \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00666}00666             worst = m1-\/m0;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00667}00667             worst\_q = q -\/ i;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00668}00668           \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00669}00669         \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00670}00670         \textcolor{comment}{// after 400 keys, take the worst 20 keys, and try each one}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00671}00671         worst = 0;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00672}00672         q = worst\_q;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00673}00673         \textcolor{keywordflow}{for} (i=0; i < 20; ++i) \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00674}00674           total += flush\_cache();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00675}00675           m0 = \_\_rdtsc();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00676}00676           total += hmget(map, q); \textcolor{comment}{// hit}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00677}00677           m1 = \_\_rdtsc();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00678}00678           \textcolor{keywordflow}{if} (m1 -\/ m0 > worst)}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00679}00679             worst = m1-\/m0;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00680}00680         \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00681}00681         times[z] = worst;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00682}00682       \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00683}00683       \textcolor{comment}{// find the worst time in the bunch}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00684}00684       worst = 0;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00685}00685       \textcolor{keywordflow}{for} (i=0; i < z; ++i)}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00686}00686         \textcolor{keywordflow}{if} (times[i] > worst)}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00687}00687           worst = times[i];}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00688}00688       \textcolor{keywordflow}{if} (worst < mstats[1][j].end)}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00689}00689         mstats[1][j].end = worst;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00690}00690       mstats[1][j].start = 0;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00691}00691       mstats[1][j].table\_size = k >> step\_log2;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00692}00692 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00693}00693       \textcolor{comment}{// expand table}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00694}00694       \textcolor{keywordflow}{for} (i=0; i < (1<<(j>>4)); ++i) \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00695}00695         hmput(map, k,k+1);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00696}00696         k += \mbox{\hyperlink{group__core__func__common_ga015a1261ff23e12650211aa872863cce}{step}};}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00697}00697       \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00698}00698     \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00699}00699     hmfree(map);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00700}00700   \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00701}00701 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00702}00702   t1 = \_\_rdtsc();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00703}00703   measure();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00704}00704   length = end();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00705}00705   rdtsc\_scale = length / (t1-\/t0) * 1000;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00706}00706 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00707}00707   \textcolor{keywordflow}{for} (j=first\_step; j <= last\_step; ++j) \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00708}00708     printf(\textcolor{stringliteral}{"{}\%12.4f,\%12d,0,1,0,1\(\backslash\)n"{}}, (mstats[0][j].end -\/ mstats[0][j].start) * rdtsc\_scale, mstats[0][j].table\_size);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00709}00709   \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00710}00710   \textcolor{keywordflow}{for} (j=first\_step; j <= last\_step; ++j) \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00711}00711     printf(\textcolor{stringliteral}{"{}\%12.4f,\%12d,0,0,1,1\(\backslash\)n"{}}, (mstats[1][j].end -\/ mstats[1][j].start) * rdtsc\_scale, mstats[1][j].table\_size);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00712}00712   \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00713}00713   \textcolor{keywordflow}{return} total;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00714}00714 \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00715}00715 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00716}00716 \textcolor{keywordtype}{int} measure\_worst\_lookup4\_b(\textcolor{keywordtype}{int} step\_log2)}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00717}00717 \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00718}00718   \textcolor{keywordtype}{int} total;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00719}00719   \textcolor{keywordtype}{double} length;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00720}00720   \textcolor{keywordtype}{int} i,j,k=0,q,worst\_q,n,z,attempts;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00721}00721   \textcolor{keywordtype}{int} \mbox{\hyperlink{group__core__func__common_ga015a1261ff23e12650211aa872863cce}{step}} = 1 << step\_log2;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00722}00722   \textcolor{keywordtype}{unsigned} \_\_int64 t0,t1;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00723}00723   \textcolor{keywordtype}{unsigned} \_\_int64 m0,m1,worst;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00724}00724   \textcolor{keyword}{struct }\{ \textcolor{keywordtype}{int} key,\mbox{\hyperlink{classvalue}{value}}; \} *map=NULL;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00725}00725   \textcolor{keywordtype}{double} rdtsc\_scale;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00726}00726   begin();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00727}00727   t0 = \_\_rdtsc();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00728}00728 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00729}00729   memset(mstats, 0, \textcolor{keyword}{sizeof}(mstats));}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00730}00730   \textcolor{keywordflow}{for} (j=first\_step; j <= last\_step; ++j)}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00731}00731     mstats[0][j].end = mstats[1][j].end = \string~(\textcolor{keywordtype}{unsigned} \_\_int64) 0;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00732}00732 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00733}00733   k = 0;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00734}00734   stbds\_rand\_seed(0); \textcolor{comment}{// force us to get the same table every time}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00735}00735   \textcolor{keywordflow}{for} (i=0; i < 128; ++i) \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00736}00736     hmput(map,k,k+1);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00737}00737     k += \mbox{\hyperlink{group__core__func__common_ga015a1261ff23e12650211aa872863cce}{step}};}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00738}00738   \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00739}00739   \textcolor{keywordflow}{for} (j=first\_step; j <= last\_step; ++j) \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00740}00740     \textcolor{keywordtype}{unsigned} \_\_int64 times[32];}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00741}00741 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00742}00742     \textcolor{comment}{// find the worst hit time}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00743}00743     \textcolor{keywordflow}{for} (z=0; z < 8; ++z) \{ \textcolor{comment}{// try this 8 times}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00744}00744       worst = 0;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00745}00745       q=0;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00746}00746       \textcolor{keywordflow}{for} (i=0; i < 5000; ++i) \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00747}00747         total += hmget(map, q);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00748}00748         m0 = \_\_rdtsc();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00749}00749         total += hmget(map, q);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00750}00750         m1 = \_\_rdtsc();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00751}00751         \textcolor{keywordflow}{if} (m1 -\/ m0 > worst) \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00752}00752           worst = m1-\/m0;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00753}00753           worst\_q = q -\/ i;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00754}00754         \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00755}00755         \textcolor{keywordflow}{if} (++q == k) q = 0;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00756}00756       \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00757}00757       \textcolor{comment}{// now retry with the worst one, but find the shortest time for it}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00758}00758       worst = \string~(\textcolor{keywordtype}{unsigned} \_\_int64) 0;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00759}00759       \textcolor{keywordflow}{for} (i=0; i < 4; ++i) \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00760}00760         total += flush\_cache();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00761}00761         m0 = \_\_rdtsc();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00762}00762         total += hmget(map,worst\_q);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00763}00763         m1 = \_\_rdtsc();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00764}00764         \textcolor{keywordflow}{if} (m1-\/m0 < worst)}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00765}00765           worst = m1-\/m0;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00766}00766       \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00767}00767       times[z] = worst;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00768}00768     \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00769}00769 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00770}00770     \textcolor{comment}{// find the worst of those}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00771}00771     worst = 0;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00772}00772     \textcolor{keywordflow}{for} (i=0; i < z; ++i)}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00773}00773       \textcolor{keywordflow}{if} (times[i] > worst)}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00774}00774         worst = times[i];}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00775}00775     mstats[0][j].start = 0;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00776}00776     mstats[0][j].end = worst;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00777}00777     mstats[0][j].table\_size = k;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00778}00778 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00779}00779     \textcolor{comment}{// find the worst miss time}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00780}00780     \textcolor{keywordflow}{for} (z=0; z < 8; ++z) \{ \textcolor{comment}{// try this 8 times}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00781}00781       worst = 0;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00782}00782       q=k;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00783}00783       \textcolor{keywordflow}{for} (i=0; i < 5000; ++i) \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00784}00784         total += hmget(map, q);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00785}00785         m0 = \_\_rdtsc();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00786}00786         total += hmget(map, q);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00787}00787         m1 = \_\_rdtsc();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00788}00788         \textcolor{keywordflow}{if} (m1 -\/ m0 > worst) \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00789}00789           worst = m1-\/m0;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00790}00790           worst\_q = q -\/ i;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00791}00791         \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00792}00792         \textcolor{comment}{//printf("{}\%6llu "{}, m1-\/m0);}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00793}00793       \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00794}00794       \textcolor{comment}{// now retry with the worst one, but find the shortest time for it}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00795}00795       worst = \string~(\textcolor{keywordtype}{unsigned} \_\_int64) 0;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00796}00796       \textcolor{keywordflow}{for} (i=0; i < 4; ++i) \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00797}00797         total += flush\_cache();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00798}00798         m0 = \_\_rdtsc();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00799}00799         total += hmget(map,worst\_q);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00800}00800         m1 = \_\_rdtsc();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00801}00801         \textcolor{keywordflow}{if} (m1-\/m0 < worst)}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00802}00802           worst = m1-\/m0;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00803}00803       \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00804}00804       times[z] = worst;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00805}00805     \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00806}00806 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00807}00807     \textcolor{comment}{// find the worst of those}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00808}00808     worst = 0;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00809}00809     \textcolor{keywordflow}{for} (i=0; i < z; ++i)}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00810}00810       \textcolor{keywordflow}{if} (times[i] > worst)}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00811}00811         worst = times[i];}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00812}00812     mstats[1][j].start = 0;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00813}00813     mstats[1][j].end = worst;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00814}00814     mstats[1][j].table\_size = k;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00815}00815 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00816}00816     \textcolor{comment}{// expand table}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00817}00817     \textcolor{keywordflow}{for} (i=0; i < (1<<(j>>4)); ++i) \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00818}00818       hmput(map, k,k+1);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00819}00819       k += \mbox{\hyperlink{group__core__func__common_ga015a1261ff23e12650211aa872863cce}{step}};}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00820}00820     \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00821}00821   \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00822}00822   hmfree(map);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00823}00823 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00824}00824   t1 = \_\_rdtsc();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00825}00825   measure();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00826}00826   length = end();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00827}00827   rdtsc\_scale = length / (t1-\/t0) * 1000;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00828}00828 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00829}00829   \textcolor{keywordflow}{for} (j=first\_step+1; j <= last\_step; ++j) \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00830}00830     printf(\textcolor{stringliteral}{"{}\%12.4f,\%12d,0,1,0,1\(\backslash\)n"{}}, (mstats[0][j].end -\/ mstats[0][j].start) * rdtsc\_scale, mstats[0][j].table\_size);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00831}00831   \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00832}00832   \textcolor{keywordflow}{for} (j=first\_step+1; j <= last\_step; ++j) \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00833}00833     printf(\textcolor{stringliteral}{"{}\%12.4f,\%12d,0,0,1,1\(\backslash\)n"{}}, (mstats[1][j].end -\/ mstats[1][j].start) * rdtsc\_scale, mstats[1][j].table\_size);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00834}00834   \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00835}00835   \textcolor{keywordflow}{return} total;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00836}00836 \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00837}00837 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00838}00838 \textcolor{keywordtype}{int} measure\_uncached\_lookup4(\textcolor{keywordtype}{int} step\_log2)}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00839}00839 \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00840}00840   \textcolor{keywordtype}{int} total;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00841}00841   \textcolor{keywordtype}{double} length;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00842}00842   \textcolor{keywordtype}{int} i,j,k=0,q;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00843}00843   \textcolor{keywordtype}{int} \mbox{\hyperlink{group__core__func__common_ga015a1261ff23e12650211aa872863cce}{step}} = 1 << step\_log2;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00844}00844   \textcolor{keywordtype}{unsigned} \_\_int64 t0,t1;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00845}00845   \textcolor{keyword}{struct }\{ \textcolor{keywordtype}{int} key,\mbox{\hyperlink{classvalue}{value}}; \} *map=NULL;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00846}00846   \textcolor{keywordtype}{double} rdtsc\_scale;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00847}00847   begin();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00848}00848   t0 = \_\_rdtsc();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00849}00849 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00850}00850   map = NULL;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00851}00851   \textcolor{keywordflow}{for} (i=0; i < 128; ++i) \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00852}00852     hmput(map,k,k+1);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00853}00853     k += \mbox{\hyperlink{group__core__func__common_ga015a1261ff23e12650211aa872863cce}{step}};}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00854}00854   \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00855}00855   \textcolor{keywordflow}{for} (j=first\_step; j <= last\_step; ++j) \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00856}00856     mstats[0][j].start = \_\_rdtsc();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00857}00857     mstats[0][j].end = 0;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00858}00858     \textcolor{keywordflow}{for} (q=i=0; i < 512; ++i) \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00859}00859       \textcolor{keywordflow}{if} ((i \& 3) == 0) \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00860}00860         mstats[0][j].end += \_\_rdtsc();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00861}00861         total += flush\_cache();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00862}00862         mstats[0][j].start += \_\_rdtsc();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00863}00863       \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00864}00864       total += hmget(map, q); \textcolor{comment}{// hit}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00865}00865       \textcolor{keywordflow}{if} (++q == k) q = 0;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00866}00866     \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00867}00867     mstats[0][j].end += \_\_rdtsc();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00868}00868     mstats[0][j].table\_size = k;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00869}00869     total += flush\_cache();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00870}00870     mstats[1][j].end = 0;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00871}00871     mstats[1][j].start = \_\_rdtsc();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00872}00872     \textcolor{keywordflow}{for} (i=0; i < 512; ++i) \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00873}00873       \textcolor{keywordflow}{if} ((i \& 3) == 0) \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00874}00874         mstats[1][j].end += \_\_rdtsc();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00875}00875         total += flush\_cache();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00876}00876         mstats[1][j].start += \_\_rdtsc();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00877}00877       \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00878}00878       total += hmget(map, i+k); \textcolor{comment}{// miss}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00879}00879     \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00880}00880     mstats[1][j].end += \_\_rdtsc();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00881}00881     mstats[1][j].table\_size = k;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00882}00882 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00883}00883     \textcolor{comment}{// expand table}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00884}00884     \textcolor{keywordflow}{for} (i=0; i < (1<<(j>>4)); ++i) \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00885}00885       hmput(map, k,k+1);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00886}00886       k += \mbox{\hyperlink{group__core__func__common_ga015a1261ff23e12650211aa872863cce}{step}};}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00887}00887     \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00888}00888   \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00889}00889   hmfree(map);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00890}00890 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00891}00891   t1 = \_\_rdtsc();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00892}00892   measure();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00893}00893   length = end();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00894}00894   rdtsc\_scale = length / (t1-\/t0) * 1000;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00895}00895 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00896}00896   \textcolor{keywordflow}{for} (j=first\_step; j <= last\_step; ++j) \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00897}00897     printf(\textcolor{stringliteral}{"{}\%12.4f,\%12d,0,512,0,4\(\backslash\)n"{}}, (mstats[0][j].end -\/ mstats[0][j].start) * rdtsc\_scale, mstats[0][j].table\_size);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00898}00898   \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00899}00899   \textcolor{keywordflow}{for} (j=first\_step; j <= last\_step; ++j) \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00900}00900     printf(\textcolor{stringliteral}{"{}\%12.4f,\%12d,0,0,512,4\(\backslash\)n"{}}, (mstats[1][j].end -\/ mstats[1][j].start) * rdtsc\_scale, mstats[1][j].table\_size);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00901}00901   \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00902}00902   \textcolor{keywordflow}{return} total;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00903}00903 \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00904}00904 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00905}00905 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00906}00906 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00907}00907 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00908}00908 \textcolor{keywordtype}{int} main(\textcolor{keywordtype}{int} arg, \textcolor{keywordtype}{char} **argv)}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00909}00909 \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00910}00910   \textcolor{keywordtype}{int} n,s,w;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00911}00911   \textcolor{keywordtype}{double} worst = 0;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00912}00912 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00913}00913   printf(\textcolor{stringliteral}{"{}\# size\_t=\%d,"{}}, (\textcolor{keywordtype}{int}) \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{size\_t}));}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00914}00914 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00915}00915 \textcolor{comment}{// number of cache-\/lines}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00916}00916 \textcolor{preprocessor}{\#ifdef STBDS\_SMALL\_BUCKET}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00917}00917   printf(\textcolor{stringliteral}{"{}cacheline=\%d,"{}}, 1);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00918}00918 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00919}00919   printf(\textcolor{stringliteral}{"{}cacheline=\%d,"{}}, \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{size\_t})==8 ? 2 : 1);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00920}00920 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00921}00921 \textcolor{preprocessor}{\#ifdef STBDS\_FLUSH\_CACHE}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00922}00922   printf(\textcolor{stringliteral}{"{}\%d,"{}}, (\textcolor{keywordtype}{int}) stbds\_log2(STBDS\_FLUSH\_CACHE));}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00923}00923 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00924}00924   printf(\textcolor{stringliteral}{"{}0,"{}});}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00925}00925 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00926}00926 \textcolor{preprocessor}{\#ifdef STBDS\_BUCKET\_START    }\textcolor{comment}{// don't bother offseting differently within bucket for different hash values}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00927}00927   printf(\textcolor{stringliteral}{"{}STBDS\_BUCKET\_START,"{}});}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00928}00928 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00929}00929   printf(\textcolor{stringliteral}{"{},"{}});}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00930}00930 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00931}00931 \textcolor{preprocessor}{\#ifdef STBDS\_SIPHASH\_2\_4}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00932}00932   printf(\textcolor{stringliteral}{"{}STBDS\_SIPHASH\_2\_4,"{}});}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00933}00933 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00934}00934   printf(\textcolor{stringliteral}{"{},"{}});}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00935}00935 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00936}00936   printf(\textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00937}00937 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00938}00938   measure\_worst\_lookup4\_b(0);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00939}00939   \textcolor{comment}{//measure\_worst\_lookup4\_a(0);}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00940}00940   measure\_average\_lookup4(0);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00941}00941   measure\_uncached\_lookup4(0);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00942}00942   measure\_build4(0);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00943}00943   \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00944}00944 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00945}00945 \textcolor{preprocessor}{\#if 0}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00946}00946   begin(); \textcolor{keywordflow}{for} (n=0; n < 2000; ++n) \{ build\_stb(2000,0,0,1);          \} end(); printf(\textcolor{stringliteral}{"{}  // \%7.2fms :      2,000 inserts creating 2K table\(\backslash\)n"{}}, timer);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00947}00947   begin(); \textcolor{keywordflow}{for} (n=0; n <  500; ++n) \{ build\_stb(20000,0,0,1);         \} end(); printf(\textcolor{stringliteral}{"{}  // \%7.2fms :     20,000 inserts creating 20K table\(\backslash\)n"{}}, timer);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00948}00948   begin(); \textcolor{keywordflow}{for} (n=0; n <  100; ++n) \{ build\_stb(200000,0,0,1);        \} end(); printf(\textcolor{stringliteral}{"{}  // \%7.2fms :    200,000 inserts creating 200K table\(\backslash\)n"{}}, timer);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00949}00949   begin(); \textcolor{keywordflow}{for} (n=0; n <   10; ++n) \{ build\_stb(2000000,0,0,1);       \} end(); printf(\textcolor{stringliteral}{"{}  // \%7.2fms :  2,000,000 inserts creating 2M table\(\backslash\)n"{}}, timer);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00950}00950   begin(); \textcolor{keywordflow}{for} (n=0; n <    5; ++n) \{ build\_stb(20000000,0,0,1);      \} end(); printf(\textcolor{stringliteral}{"{}  // \%7.2fms : 20,000,000 inserts creating 20M table\(\backslash\)n"{}}, timer);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00951}00951 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00952}00952 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00953}00953 \textcolor{preprocessor}{\#if 0}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00954}00954   begin(); \textcolor{keywordflow}{for} (n=0; n < 2000; ++n) \{ churn32(2000,0,0,1);          \} end(); printf(\textcolor{stringliteral}{"{}  // \%7.2fms :      2,000 inserts creating 2K table w/ 32-\/byte key\(\backslash\)n"{}}, timer);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00955}00955   begin(); \textcolor{keywordflow}{for} (n=0; n <  500; ++n) \{ churn32(20000,0,0,1);         \} end(); printf(\textcolor{stringliteral}{"{}  // \%7.2fms :     20,000 inserts creating 20K table w/ 32-\/byte key\(\backslash\)n"{}}, timer);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00956}00956   begin(); \textcolor{keywordflow}{for} (n=0; n <  100; ++n) \{ churn32(200000,0,0,1);        \} end(); printf(\textcolor{stringliteral}{"{}  // \%7.2fms :    200,000 inserts creating 200K table w/ 32-\/byte key\(\backslash\)n"{}}, timer);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00957}00957   begin(); \textcolor{keywordflow}{for} (n=0; n <   10; ++n) \{ churn32(2000000,0,0,1);       \} end(); printf(\textcolor{stringliteral}{"{}  // \%7.2fms :  2,000,000 inserts creating 2M table w/ 32-\/byte key\(\backslash\)n"{}}, timer);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00958}00958   begin(); \textcolor{keywordflow}{for} (n=0; n <    5; ++n) \{ churn32(20000000,0,0,1);      \} end(); printf(\textcolor{stringliteral}{"{}  // \%7.2fms : 20,000,000 inserts creating 20M table w/ 32-\/byte key\(\backslash\)n"{}}, timer);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00959}00959 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00960}00960   begin(); \textcolor{keywordflow}{for} (n=0; n < 2000; ++n) \{ churn256(2000,0,0,1);          \} end(); printf(\textcolor{stringliteral}{"{}  // \%7.2fms :      2,000 inserts creating 2K table w/ 256-\/byte key\(\backslash\)n"{}}, timer);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00961}00961   begin(); \textcolor{keywordflow}{for} (n=0; n <  500; ++n) \{ churn256(20000,0,0,1);         \} end(); printf(\textcolor{stringliteral}{"{}  // \%7.2fms :     20,000 inserts creating 20K table w/ 256-\/byte key\(\backslash\)n"{}}, timer);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00962}00962   begin(); \textcolor{keywordflow}{for} (n=0; n <  100; ++n) \{ churn256(200000,0,0,1);        \} end(); printf(\textcolor{stringliteral}{"{}  // \%7.2fms :    200,000 inserts creating 200K table w/ 256-\/byte key\(\backslash\)n"{}}, timer);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00963}00963   begin(); \textcolor{keywordflow}{for} (n=0; n <   10; ++n) \{ churn256(2000000,0,0,1);       \} end(); printf(\textcolor{stringliteral}{"{}  // \%7.2fms :  2,000,000 inserts creating 2M table w/ 256-\/byte key\(\backslash\)n"{}}, timer);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00964}00964   begin(); \textcolor{keywordflow}{for} (n=0; n <    5; ++n) \{ churn256(20000000,0,0,1);      \} end(); printf(\textcolor{stringliteral}{"{}  // \%7.2fms : 20,000,000 inserts creating 20M table w/ 256-\/byte key\(\backslash\)n"{}}, timer);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00965}00965 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00966}00966 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00967}00967   begin(); \textcolor{keywordflow}{for} (n=0; n <   20; ++n) \{ multisearch\_stb(2000,0,2000,1,1000);    \} end(); printf(\textcolor{stringliteral}{"{}  // \%7.2fms : 2,000,000 hits on 1,000   2K table w/ 4-\/byte key\(\backslash\)n"{}}, timer);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00968}00968   begin(); \textcolor{keywordflow}{for} (n=0; n <   10; ++n) \{ multisearch\_stb(20000,0,2000,1,1000);   \} end(); printf(\textcolor{stringliteral}{"{}  // \%7.2fms : 2,000,000 hits on 1,000  20K table w/ 4-\/byte key\(\backslash\)n"{}}, timer);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00969}00969   begin(); \textcolor{keywordflow}{for} (n=0; n <    6; ++n) \{ multisearch\_stb(200000,0,2000,1,1000);  \} end(); printf(\textcolor{stringliteral}{"{}  // \%7.2fms : 2,000,000 hits on 1,000 200K table w/ 4-\/byte key\(\backslash\)n"{}}, timer);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00970}00970   begin(); \textcolor{keywordflow}{for} (n=0; n <    2; ++n) \{ multisearch\_stb(2000000,0,20000,1,100); \} end(); printf(\textcolor{stringliteral}{"{}  // \%7.2fms : 2,000,000 hits on   100   2M table w/ 4-\/byte key\(\backslash\)n"{}}, timer);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00971}00971 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00972}00972   begin(); \textcolor{keywordflow}{for} (n=0; n <   20; ++n) \{ multisearch    (2000,0,2000,1,1000);    \} end(); printf(\textcolor{stringliteral}{"{}  // \%7.2fms : 2,000,000 hits on 1,000   2K table w/ 4-\/byte key\(\backslash\)n"{}}, timer);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00973}00973   begin(); \textcolor{keywordflow}{for} (n=0; n <   10; ++n) \{ multisearch    (20000,0,2000,1,1000);   \} end(); printf(\textcolor{stringliteral}{"{}  // \%7.2fms : 2,000,000 hits on 1,000  20K table w/ 4-\/byte key\(\backslash\)n"{}}, timer);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00974}00974   begin(); \textcolor{keywordflow}{for} (n=0; n <    6; ++n) \{ multisearch    (200000,0,2000,1,1000);  \} end(); printf(\textcolor{stringliteral}{"{}  // \%7.2fms : 2,000,000 hits on 1,000 200K table w/ 4-\/byte key\(\backslash\)n"{}}, timer);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00975}00975   begin(); \textcolor{keywordflow}{for} (n=0; n <    2; ++n) \{ multisearch    (2000000,0,20000,1,100); \} end(); printf(\textcolor{stringliteral}{"{}  // \%7.2fms : 2,000,000 hits on   100   2M table w/ 4-\/byte key\(\backslash\)n"{}}, timer);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00976}00976 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00977}00977 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00978}00978 \textcolor{preprocessor}{\#if 1}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00979}00979   begin(); \textcolor{keywordflow}{for} (n=0; n <    2; ++n) \{ multibuild\_stb(2000,0,0,1,10000); \} end(); printf(\textcolor{stringliteral}{"{}  // \%7.2fms : 20,000,000 inserts creating 10,000   2K table w/ 4-\/byte key\(\backslash\)n"{}}, timer);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00980}00980   begin(); \textcolor{keywordflow}{for} (n=0; n <    2; ++n) \{ multibuild\_stb(20000,0,0,1,1000); \} end(); printf(\textcolor{stringliteral}{"{}  // \%7.2fms : 20,000,000 inserts creating  1,000  20K table w/ 4-\/byte key\(\backslash\)n"{}}, timer);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00981}00981   begin(); \textcolor{keywordflow}{for} (n=0; n <    2; ++n) \{ multibuild\_stb(200000,0,0,1,100); \} end(); printf(\textcolor{stringliteral}{"{}  // \%7.2fms : 20,000,000 inserts creating    100 200K table w/ 4-\/byte key\(\backslash\)n"{}}, timer);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00982}00982   begin(); \textcolor{keywordflow}{for} (n=0; n <    2; ++n) \{ multibuild\_stb(2000000,0,0,1,10); \} end(); printf(\textcolor{stringliteral}{"{}  // \%7.2fms : 20,000,000 inserts creating     10   2M table w/ 4-\/byte key\(\backslash\)n"{}}, timer);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00983}00983 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00984}00984   begin(); \textcolor{keywordflow}{for} (n=0; n <    2; ++n) \{ multichurn4(2000,0,0,1,10000); \} end(); printf(\textcolor{stringliteral}{"{}  // \%7.2fms : 20,000,000 inserts creating 10,000   2K table w/ 4-\/byte key\(\backslash\)n"{}}, timer);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00985}00985   begin(); \textcolor{keywordflow}{for} (n=0; n <    2; ++n) \{ multichurn4(20000,0,0,1,1000); \} end(); printf(\textcolor{stringliteral}{"{}  // \%7.2fms : 20,000,000 inserts creating  1,000  20K table w/ 4-\/byte key\(\backslash\)n"{}}, timer);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00986}00986   begin(); \textcolor{keywordflow}{for} (n=0; n <    2; ++n) \{ multichurn4(200000,0,0,1,100); \} end(); printf(\textcolor{stringliteral}{"{}  // \%7.2fms : 20,000,000 inserts creating    100 200K table w/ 4-\/byte key\(\backslash\)n"{}}, timer);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00987}00987   begin(); \textcolor{keywordflow}{for} (n=0; n <    2; ++n) \{ multichurn4(2000000,0,0,1,10); \} end(); printf(\textcolor{stringliteral}{"{}  // \%7.2fms : 20,000,000 inserts creating     10   2M table w/ 4-\/byte key\(\backslash\)n"{}}, timer);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00988}00988 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00989}00989 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00990}00990   begin(); \textcolor{keywordflow}{for} (n=0; n < 2000; ++n) \{ build(2000,0,0,1);          \} end(); printf(\textcolor{stringliteral}{"{}  // \%7.2fms :      2,000 inserts creating 2K table w/ 4-\/byte key\(\backslash\)n"{}}, timer);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00991}00991   begin(); \textcolor{keywordflow}{for} (n=0; n <  500; ++n) \{ build(20000,0,0,1);         \} end(); printf(\textcolor{stringliteral}{"{}  // \%7.2fms :     20,000 inserts creating 20K table w/ 4-\/byte key\(\backslash\)n"{}}, timer);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00992}00992   begin(); \textcolor{keywordflow}{for} (n=0; n <  100; ++n) \{ build(200000,0,0,1);        \} end(); printf(\textcolor{stringliteral}{"{}  // \%7.2fms :    200,000 inserts creating 200K table w/ 4-\/byte key\(\backslash\)n"{}}, timer);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00993}00993   begin(); \textcolor{keywordflow}{for} (n=0; n <   10; ++n) \{ build(2000000,0,0,1);       \} end(); printf(\textcolor{stringliteral}{"{}  // \%7.2fms :  2,000,000 inserts creating 2M table w/ 4-\/byte key\(\backslash\)n"{}}, timer);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00994}00994   begin(); \textcolor{keywordflow}{for} (n=0; n <    5; ++n) \{ build(20000000,0,0,1);      \} end(); printf(\textcolor{stringliteral}{"{}  // \%7.2fms : 20,000,000 inserts creating 20M table w/ 4-\/byte key\(\backslash\)n"{}}, timer);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00995}00995 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00996}00996   begin(); \textcolor{keywordflow}{for} (n=0; n < 2000; ++n) \{ churn8(2000,0,0,1);          \} end(); printf(\textcolor{stringliteral}{"{}  // \%7.2fms :      2,000 inserts creating 2K table w/ 8-\/byte key\(\backslash\)n"{}}, timer);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00997}00997   begin(); \textcolor{keywordflow}{for} (n=0; n <  500; ++n) \{ churn8(20000,0,0,1);         \} end(); printf(\textcolor{stringliteral}{"{}  // \%7.2fms :     20,000 inserts creating 20K table w/ 8-\/byte key\(\backslash\)n"{}}, timer);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00998}00998   begin(); \textcolor{keywordflow}{for} (n=0; n <  100; ++n) \{ churn8(200000,0,0,1);        \} end(); printf(\textcolor{stringliteral}{"{}  // \%7.2fms :    200,000 inserts creating 200K table w/ 8-\/byte key\(\backslash\)n"{}}, timer);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l00999}00999   begin(); \textcolor{keywordflow}{for} (n=0; n <   10; ++n) \{ churn8(2000000,0,0,1);       \} end(); printf(\textcolor{stringliteral}{"{}  // \%7.2fms :  2,000,000 inserts creating 2M table w/ 8-\/byte key\(\backslash\)n"{}}, timer);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l01000}01000   begin(); \textcolor{keywordflow}{for} (n=0; n <    5; ++n) \{ churn8(20000000,0,0,1);      \} end(); printf(\textcolor{stringliteral}{"{}  // \%7.2fms : 20,000,000 inserts creating 20M table w/ 8-\/byte key\(\backslash\)n"{}}, timer);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l01001}01001 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l01002}01002   begin(); \textcolor{keywordflow}{for} (n=0; n <   60; ++n) \{ churn\_skip(2000,2100,5000);            \} end(); printf(\textcolor{stringliteral}{"{}  // \%7.2fms : 500,000 inserts \& deletes in 2K table\(\backslash\)n"{}}, timer);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l01003}01003   begin(); \textcolor{keywordflow}{for} (n=0; n <   30; ++n) \{ churn\_skip(20000,21000,500);           \} end(); printf(\textcolor{stringliteral}{"{}  // \%7.2fms : 500,000 inserts \& deletes in 20K table\(\backslash\)n"{}}, timer);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l01004}01004   begin(); \textcolor{keywordflow}{for} (n=0; n <   15; ++n) \{ churn\_skip(200000,201000,500);         \} end(); printf(\textcolor{stringliteral}{"{}  // \%7.2fms : 500,000 inserts \& deletes in 200K table\(\backslash\)n"{}}, timer);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l01005}01005   begin(); \textcolor{keywordflow}{for} (n=0; n <    8; ++n) \{ churn\_skip(2000000,2001000,500);       \} end(); printf(\textcolor{stringliteral}{"{}  // \%7.2fms : 500,000 inserts \& deletes in 2M table\(\backslash\)n"{}}, timer);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l01006}01006   begin(); \textcolor{keywordflow}{for} (n=0; n <    5; ++n) \{ churn\_skip(20000000,20001000,500);     \} end(); printf(\textcolor{stringliteral}{"{}  // \%7.2fms : 500,000 inserts \& deletes in 20M table\(\backslash\)n"{}}, timer);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l01007}01007   begin(); \textcolor{keywordflow}{for} (n=0; n <    1; ++n) \{ churn\_skip(200000000u,200001000u,500); \} end(); printf(\textcolor{stringliteral}{"{}  // \%7.2fms : 500,000 inserts \& deletes in 200M table\(\backslash\)n"{}}, timer);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l01008}01008   \textcolor{comment}{// even though the above measures a roughly fixed amount of work, we still have to build the table n times, hence the fewer measurements each time}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l01009}01009 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l01010}01010   begin(); \textcolor{keywordflow}{for} (n=0; n <   60; ++n) \{ churn\_skip(1000,3000,250);             \} end(); printf(\textcolor{stringliteral}{"{}  // \%7.2fms :    500,000 inserts \& deletes in 2K table\(\backslash\)n"{}}, timer);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l01011}01011   begin(); \textcolor{keywordflow}{for} (n=0; n <   15; ++n) \{ churn\_skip(10000,30000,25);            \} end(); printf(\textcolor{stringliteral}{"{}  // \%7.2fms :    500,000 inserts \& deletes in 20K table\(\backslash\)n"{}}, timer);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l01012}01012   begin(); \textcolor{keywordflow}{for} (n=0; n <    7; ++n) \{ churn\_skip(100000,300000,10);          \} end(); printf(\textcolor{stringliteral}{"{}  // \%7.2fms :  2,000,000 inserts \& deletes in 200K table\(\backslash\)n"{}}, timer);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l01013}01013   begin(); \textcolor{keywordflow}{for} (n=0; n <    2; ++n) \{ churn\_skip(1000000,3000000,10);        \} end(); printf(\textcolor{stringliteral}{"{}  // \%7.2fms : 20,000,000 inserts \& deletes in 2M table\(\backslash\)n"{}}, timer);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l01014}01014 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l01015}01015   \textcolor{comment}{// search for bad intervals.. in practice this just seems to measure execution variance}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l01016}01016   \textcolor{keywordflow}{for} (s = 2; s < 64; ++s) \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l01017}01017     begin(); \textcolor{keywordflow}{for} (n=0; n < 50; ++n) \{ build(200000,0,0,s); \} end();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l01018}01018     \textcolor{keywordflow}{if} (timer > worst) \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l01019}01019       worst = timer;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l01020}01020       w = s;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l01021}01021     \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l01022}01022   \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l01023}01023   \textcolor{keywordflow}{for} (; s <= 1024; s *= 2) \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l01024}01024     begin(); \textcolor{keywordflow}{for} (n=0; n < 50; ++n) \{ build(200000,0,0,s); \} end();}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l01025}01025     \textcolor{keywordflow}{if} (timer > worst) \{}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l01026}01026       worst = timer;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l01027}01027       w = s;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l01028}01028     \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l01029}01029   \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l01030}01030   printf(\textcolor{stringliteral}{"{}  // \%7.2fms(\%d)   : Worst time from inserting 200,000 items with spacing \%d.\(\backslash\)n"{}}, worst, w, w);}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l01031}01031 }
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l01032}01032   \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l01033}01033 \}}
\DoxyCodeLine{\Hypertarget{test__ds_8c_source_l01034}01034 \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
