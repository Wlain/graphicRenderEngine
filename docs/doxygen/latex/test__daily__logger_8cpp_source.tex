\hypertarget{test__daily__logger_8cpp_source}{}\doxysection{test\+\_\+daily\+\_\+logger.\+cpp}
\label{test__daily__logger_8cpp_source}\index{/Users/cwb/developer/learning/graphicRenderEngine/ceres/3rdparty/spdlog/tests/test\_daily\_logger.cpp@{/Users/cwb/developer/learning/graphicRenderEngine/ceres/3rdparty/spdlog/tests/test\_daily\_logger.cpp}}

\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00001}00001 \textcolor{comment}{/*}}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00002}00002 \textcolor{comment}{ * This content is released under the MIT License as specified in https://raw.githubusercontent.com/gabime/spdlog/master/LICENSE}}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00003}00003 \textcolor{comment}{ */}}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00004}00004 \textcolor{preprocessor}{\#include "{}includes.h"{}}}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00005}00005 }
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00006}00006 \textcolor{preprocessor}{\#ifdef SPDLOG\_USE\_STD\_FORMAT}}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00007}00007 \textcolor{keyword}{using} filename\_memory\_buf\_t = std::basic\_string<spdlog::filename\_t::value\_type>;}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00008}00008 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00009}00009 \textcolor{keyword}{using} filename\_memory\_buf\_t = fmt::basic\_memory\_buffer<spdlog::filename\_t::value\_type, 250>;}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00010}00010 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00011}00011 }
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00012}00012 TEST\_CASE(\textcolor{stringliteral}{"{}daily\_logger with dateonly calculator"{}}, \textcolor{stringliteral}{"{}[daily\_logger]"{}})}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00013}00013 \{}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00014}00014     \textcolor{keyword}{using} sink\_type = \mbox{\hyperlink{classspdlog_1_1sinks_1_1daily__file__sink}{spdlog::sinks::daily\_file\_sink<std::mutex, spdlog::sinks::daily\_filename\_calculator>}};}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00015}00015 }
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00016}00016     prepare\_logdir();}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00017}00017 }
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00018}00018     \textcolor{comment}{// calculate filename (time based)}}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00019}00019     spdlog::filename\_t basename = SPDLOG\_FILENAME\_T(\textcolor{stringliteral}{"{}test\_logs/daily\_dateonly"{}});}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00020}00020     std::tm tm = spdlog::details::os::localtime();}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00021}00021     filename\_memory\_buf\_t w;}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00022}00022     spdlog::fmt\_lib::format\_to(}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00023}00023         std::back\_inserter(w), SPDLOG\_FILENAME\_T(\textcolor{stringliteral}{"{}\{\}\_\{:04d\}-\/\{:02d\}-\/\{:02d\}"{}}), basename, tm.tm\_year + 1900, tm.tm\_mon + 1, tm.tm\_mday);}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00024}00024 }
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00025}00025     \textcolor{keyword}{auto} logger = spdlog::create<sink\_type>(\textcolor{stringliteral}{"{}logger"{}}, basename, 0, 0);}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00026}00026     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < 10; ++i)}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00027}00027     \{}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00028}00028 }
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00029}00029         logger-\/>info(\textcolor{stringliteral}{"{}Test message \{\}"{}}, i);}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00030}00030     \}}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00031}00031     logger-\/>flush();}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00032}00032 }
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00033}00033 \textcolor{preprocessor}{\#ifdef SPDLOG\_WCHAR\_FILENAMES}}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00034}00034     spdlog::memory\_buf\_t buf;}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00035}00035 \textcolor{preprocessor}{\#    ifdef SPDLOG\_USE\_STD\_FORMAT}}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00036}00036     spdlog::details::os::wstr\_to\_utf8buf(w, buf);}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00037}00037     \textcolor{keyword}{auto} \&filename = buf;}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00038}00038 \textcolor{preprocessor}{\#    else}}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00039}00039     spdlog::details::os::wstr\_to\_utf8buf(\mbox{\hyperlink{group__gtx__string__cast_ga8f0dced1fd45e67e2d77e80ab93c7af5}{fmt::to\_string}}(w), buf);}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00040}00040     \textcolor{keyword}{auto} filename = \mbox{\hyperlink{group__gtx__string__cast_ga8f0dced1fd45e67e2d77e80ab93c7af5}{fmt::to\_string}}(buf);}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00041}00041 \textcolor{preprocessor}{\#    endif}}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00042}00042 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00043}00043 \textcolor{preprocessor}{\#    ifdef SPDLOG\_USE\_STD\_FORMAT}}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00044}00044     \textcolor{keyword}{auto} \&filename = w;}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00045}00045 \textcolor{preprocessor}{\#    else}}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00046}00046     \textcolor{keyword}{auto} filename = \mbox{\hyperlink{group__gtx__string__cast_ga8f0dced1fd45e67e2d77e80ab93c7af5}{fmt::to\_string}}(w);}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00047}00047 \textcolor{preprocessor}{\#    endif}}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00048}00048 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00049}00049     require\_message\_count(filename, 10);}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00050}00050 \}}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00051}00051 }
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00052}\mbox{\hyperlink{structcustom__daily__file__name__calculator}{00052}} \textcolor{keyword}{struct }\mbox{\hyperlink{structcustom__daily__file__name__calculator}{custom\_daily\_file\_name\_calculator}}}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00053}00053 \{}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00054}00054     \textcolor{keyword}{static} spdlog::filename\_t calc\_filename(\textcolor{keyword}{const} spdlog::filename\_t \&basename, \textcolor{keyword}{const} tm \&now\_tm)}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00055}00055     \{}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00056}00056         filename\_memory\_buf\_t w;}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00057}00057         spdlog::fmt\_lib::format\_to(std::back\_inserter(w), SPDLOG\_FILENAME\_T(\textcolor{stringliteral}{"{}\{\}\{:04d\}\{:02d\}\{:02d\}"{}}), basename, now\_tm.tm\_year + 1900,}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00058}00058             now\_tm.tm\_mon + 1, now\_tm.tm\_mday);}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00059}00059 \textcolor{preprocessor}{\#ifdef SPDLOG\_USE\_STD\_FORMAT}}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00060}00060         \textcolor{keywordflow}{return} w;}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00061}00061 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00062}00062         \textcolor{keywordflow}{return} \mbox{\hyperlink{group__gtx__string__cast_ga8f0dced1fd45e67e2d77e80ab93c7af5}{fmt::to\_string}}(w);}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00063}00063 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00064}00064     \}}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00065}00065 \};}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00066}00066 }
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00067}00067 TEST\_CASE(\textcolor{stringliteral}{"{}daily\_logger with custom calculator"{}}, \textcolor{stringliteral}{"{}[daily\_logger]"{}})}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00068}00068 \{}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00069}00069     \textcolor{keyword}{using} sink\_type = \mbox{\hyperlink{classspdlog_1_1sinks_1_1daily__file__sink}{spdlog::sinks::daily\_file\_sink<std::mutex, custom\_daily\_file\_name\_calculator>}};}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00070}00070 }
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00071}00071     prepare\_logdir();}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00072}00072 }
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00073}00073     \textcolor{comment}{// calculate filename (time based)}}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00074}00074     spdlog::filename\_t basename = SPDLOG\_FILENAME\_T(\textcolor{stringliteral}{"{}test\_logs/daily\_dateonly"{}});}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00075}00075     std::tm tm = spdlog::details::os::localtime();}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00076}00076     filename\_memory\_buf\_t w;}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00077}00077     spdlog::fmt\_lib::format\_to(}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00078}00078         std::back\_inserter(w), SPDLOG\_FILENAME\_T(\textcolor{stringliteral}{"{}\{\}\{:04d\}\{:02d\}\{:02d\}"{}}), basename, tm.tm\_year + 1900, tm.tm\_mon + 1, tm.tm\_mday);}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00079}00079 }
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00080}00080     \textcolor{keyword}{auto} logger = spdlog::create<sink\_type>(\textcolor{stringliteral}{"{}logger"{}}, basename, 0, 0);}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00081}00081     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < 10; ++i)}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00082}00082     \{}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00083}00083         logger-\/>info(\textcolor{stringliteral}{"{}Test message \{\}"{}}, i);}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00084}00084     \}}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00085}00085 }
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00086}00086     logger-\/>flush();}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00087}00087 }
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00088}00088 \textcolor{preprocessor}{\#ifdef SPDLOG\_WCHAR\_FILENAMES}}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00089}00089     spdlog::memory\_buf\_t buf;}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00090}00090 \textcolor{preprocessor}{\#    ifdef SPDLOG\_USE\_STD\_FORMAT}}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00091}00091     spdlog::details::os::wstr\_to\_utf8buf(w, buf);}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00092}00092     \textcolor{keyword}{auto} \&filename = buf;}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00093}00093 \textcolor{preprocessor}{\#    else}}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00094}00094     spdlog::details::os::wstr\_to\_utf8buf(\mbox{\hyperlink{group__gtx__string__cast_ga8f0dced1fd45e67e2d77e80ab93c7af5}{fmt::to\_string}}(w), buf);}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00095}00095     \textcolor{keyword}{auto} filename = \mbox{\hyperlink{group__gtx__string__cast_ga8f0dced1fd45e67e2d77e80ab93c7af5}{fmt::to\_string}}(buf);}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00096}00096 \textcolor{preprocessor}{\#    endif}}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00097}00097 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00098}00098 \textcolor{preprocessor}{\#    ifdef SPDLOG\_USE\_STD\_FORMAT}}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00099}00099     \textcolor{keyword}{auto} \&filename = w;}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00100}00100 \textcolor{preprocessor}{\#    else}}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00101}00101     \textcolor{keyword}{auto} filename = \mbox{\hyperlink{group__gtx__string__cast_ga8f0dced1fd45e67e2d77e80ab93c7af5}{fmt::to\_string}}(w);}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00102}00102 \textcolor{preprocessor}{\#    endif}}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00103}00103 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00104}00104     require\_message\_count(filename, 10);}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00105}00105 \}}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00106}00106 }
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00107}00107 \textcolor{comment}{/*}}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00108}00108 \textcolor{comment}{ * File name calculations}}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00109}00109 \textcolor{comment}{ */}}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00110}00110 }
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00111}00111 TEST\_CASE(\textcolor{stringliteral}{"{}rotating\_file\_sink::calc\_filename1"{}}, \textcolor{stringliteral}{"{}[rotating\_file\_sink]]"{}})}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00112}00112 \{}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00113}00113     \textcolor{keyword}{auto} filename = spdlog::sinks::rotating\_file\_sink\_st::calc\_filename(SPDLOG\_FILENAME\_T(\textcolor{stringliteral}{"{}rotated.txt"{}}), 3);}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00114}00114     REQUIRE(filename == SPDLOG\_FILENAME\_T(\textcolor{stringliteral}{"{}rotated.3.txt"{}}));}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00115}00115 \}}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00116}00116 }
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00117}00117 TEST\_CASE(\textcolor{stringliteral}{"{}rotating\_file\_sink::calc\_filename2"{}}, \textcolor{stringliteral}{"{}[rotating\_file\_sink]]"{}})}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00118}00118 \{}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00119}00119     \textcolor{keyword}{auto} filename = spdlog::sinks::rotating\_file\_sink\_st::calc\_filename(SPDLOG\_FILENAME\_T(\textcolor{stringliteral}{"{}rotated"{}}), 3);}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00120}00120     REQUIRE(filename == SPDLOG\_FILENAME\_T(\textcolor{stringliteral}{"{}rotated.3"{}}));}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00121}00121 \}}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00122}00122 }
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00123}00123 TEST\_CASE(\textcolor{stringliteral}{"{}rotating\_file\_sink::calc\_filename3"{}}, \textcolor{stringliteral}{"{}[rotating\_file\_sink]]"{}})}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00124}00124 \{}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00125}00125     \textcolor{keyword}{auto} filename = spdlog::sinks::rotating\_file\_sink\_st::calc\_filename(SPDLOG\_FILENAME\_T(\textcolor{stringliteral}{"{}rotated.txt"{}}), 0);}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00126}00126     REQUIRE(filename == SPDLOG\_FILENAME\_T(\textcolor{stringliteral}{"{}rotated.txt"{}}));}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00127}00127 \}}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00128}00128 }
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00129}00129 \textcolor{comment}{// regex supported only from gcc 4.9 and above}}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00130}00130 \textcolor{preprocessor}{\#if defined(\_MSC\_VER) || !(\_\_GNUC\_\_ <= 4 \&\& \_\_GNUC\_MINOR\_\_ < 9)}}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00131}00131 }
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00132}00132 \textcolor{preprocessor}{\#    include <regex>}}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00133}00133 }
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00134}00134 TEST\_CASE(\textcolor{stringliteral}{"{}daily\_file\_sink::daily\_filename\_calculator"{}}, \textcolor{stringliteral}{"{}[daily\_file\_sink]]"{}})}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00135}00135 \{}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00136}00136     \textcolor{comment}{// daily\_YYYY-\/MM-\/DD\_hh-\/mm.txt}}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00137}00137     \textcolor{keyword}{auto} filename =}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00138}00138         spdlog::sinks::daily\_filename\_calculator::calc\_filename(SPDLOG\_FILENAME\_T(\textcolor{stringliteral}{"{}daily.txt"{}}), spdlog::details::os::localtime());}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00139}00139     \textcolor{comment}{// date regex based on https://www.regular-\/expressions.info/dates.html}}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00140}00140     std::basic\_regex<spdlog::filename\_t::value\_type> re(}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00141}00141         SPDLOG\_FILENAME\_T(R\textcolor{stringliteral}{"{}(\string^daily\_(19|20)\(\backslash\)d\(\backslash\)d-\/(0[1-\/9]|1[012])-\/(0[1-\/9]|[12][0-\/9]|3[01])\(\backslash\).txt\$)"{}));}}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00142}00142 \textcolor{stringliteral}{    std::match\_results<spdlog::filename\_t::const\_iterator> match;}}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00143}00143 \textcolor{stringliteral}{    REQUIRE(std::regex\_match(filename, match, re));}}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00144}00144 \textcolor{stringliteral}{\}}}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00145}00145 \textcolor{stringliteral}{}\textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00146}00146 }
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00147}00147 TEST\_CASE(\textcolor{stringliteral}{"{}daily\_file\_sink::daily\_filename\_format\_calculator"{}}, \textcolor{stringliteral}{"{}[daily\_file\_sink]]"{}})}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00148}00148 \{}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00149}00149     std::tm tm = spdlog::details::os::localtime();}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00150}00150     \textcolor{comment}{// example-\/YYYY-\/MM-\/DD.log}}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00151}00151     \textcolor{keyword}{auto} filename = spdlog::sinks::daily\_filename\_format\_calculator::calc\_filename(SPDLOG\_FILENAME\_T(\textcolor{stringliteral}{"{}example-\/\%Y-\/\%m-\/\%d.log"{}}), tm);}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00152}00152 }
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00153}00153     REQUIRE(filename ==}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00154}00154             spdlog::fmt\_lib::format(SPDLOG\_FILENAME\_T(\textcolor{stringliteral}{"{}example-\/\{:04d\}-\/\{:02d\}-\/\{:02d\}.log"{}}), tm.tm\_year + 1900, tm.tm\_mon + 1, tm.tm\_mday));}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00155}00155 \}}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00156}00156 }
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00157}00157 \textcolor{comment}{/* Test removal of old files */}}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00158}00158 \textcolor{keyword}{static} \mbox{\hyperlink{structspdlog_1_1details_1_1log__msg}{spdlog::details::log\_msg}} create\_msg(std::chrono::seconds offset)}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00159}00159 \{}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00160}00160     \textcolor{keyword}{using} spdlog::log\_clock;}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00161}00161     \mbox{\hyperlink{structspdlog_1_1details_1_1log__msg}{spdlog::details::log\_msg}} msg\{\textcolor{stringliteral}{"{}test"{}}, spdlog::level::info, \textcolor{stringliteral}{"{}Hello Message"{}}\};}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00162}00162     msg.time = log\_clock::now() + offset;}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00163}00163     \textcolor{keywordflow}{return} msg;}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00164}00164 \}}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00165}00165 }
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00166}00166 \textcolor{keyword}{static} \textcolor{keywordtype}{void} test\_rotate(\textcolor{keywordtype}{int} days\_to\_run, uint16\_t max\_days, uint16\_t expected\_n\_files)}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00167}00167 \{}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00168}00168     \textcolor{keyword}{using} spdlog::log\_clock;}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00169}00169     \textcolor{keyword}{using} \mbox{\hyperlink{structspdlog_1_1details_1_1log__msg}{spdlog::details::log\_msg}};}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00170}00170     \textcolor{keyword}{using} \mbox{\hyperlink{classspdlog_1_1sinks_1_1daily__file__sink}{spdlog::sinks::daily\_file\_sink\_st}};}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00171}00171 }
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00172}00172     prepare\_logdir();}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00173}00173 }
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00174}00174     spdlog::filename\_t basename = SPDLOG\_FILENAME\_T(\textcolor{stringliteral}{"{}test\_logs/daily\_rotate.txt"{}});}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00175}00175     daily\_file\_sink\_st sink\{basename, 2, 30, \textcolor{keyword}{true}, max\_days\};}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00176}00176 }
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00177}00177     \textcolor{comment}{// simulate messages with 24 intervals}}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00178}00178 }
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00179}00179     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < days\_to\_run; i++)}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00180}00180     \{}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00181}00181         \textcolor{keyword}{auto} offset = std::chrono::seconds\{24 * 3600 * i\};}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00182}00182         sink.log(create\_msg(offset));}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00183}00183     \}}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00184}00184 }
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00185}00185     REQUIRE(count\_files(\textcolor{stringliteral}{"{}test\_logs"{}}) == \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{size\_t}\textcolor{keyword}{>}(expected\_n\_files));}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00186}00186 \}}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00187}00187 }
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00188}00188 TEST\_CASE(\textcolor{stringliteral}{"{}daily\_logger rotate"{}}, \textcolor{stringliteral}{"{}[daily\_file\_sink]"{}})}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00189}00189 \{}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00190}00190     \textcolor{keywordtype}{int} days\_to\_run = 1;}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00191}00191     test\_rotate(days\_to\_run, 0, 1);}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00192}00192     test\_rotate(days\_to\_run, 1, 1);}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00193}00193     test\_rotate(days\_to\_run, 3, 1);}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00194}00194     test\_rotate(days\_to\_run, 10, 1);}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00195}00195 }
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00196}00196     days\_to\_run = 10;}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00197}00197     test\_rotate(days\_to\_run, 0, 10);}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00198}00198     test\_rotate(days\_to\_run, 1, 1);}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00199}00199     test\_rotate(days\_to\_run, 3, 3);}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00200}00200     test\_rotate(days\_to\_run, 9, 9);}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00201}00201     test\_rotate(days\_to\_run, 10, 10);}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00202}00202     test\_rotate(days\_to\_run, 11, 10);}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00203}00203     test\_rotate(days\_to\_run, 20, 10);}
\DoxyCodeLine{\Hypertarget{test__daily__logger_8cpp_source_l00204}00204 \}}

\end{DoxyCode}
