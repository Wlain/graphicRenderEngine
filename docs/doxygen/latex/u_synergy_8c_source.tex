\hypertarget{u_synergy_8c_source}{}\doxysection{u\+Synergy.\+c}
\label{u_synergy_8c_source}\index{/Users/cwb/developer/learning/graphicRenderEngine/ceres/3rdparty/imgui/examples/libs/usynergy/uSynergy.c@{/Users/cwb/developer/learning/graphicRenderEngine/ceres/3rdparty/imgui/examples/libs/usynergy/uSynergy.c}}

\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00001}00001 \textcolor{comment}{/*}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00002}00002 \textcolor{comment}{uSynergy client -\/-\/ Implementation for the embedded Synergy client library}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00003}00003 \textcolor{comment}{  version 1.0.0, July 7th, 2012}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00004}00004 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00005}00005 \textcolor{comment}{Copyright (c) 2012 Alex Evans}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00006}00006 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00007}00007 \textcolor{comment}{This software is provided 'as-\/is', without any express or implied}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00008}00008 \textcolor{comment}{warranty. In no event will the authors be held liable for any damages}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00009}00009 \textcolor{comment}{arising from the use of this software.}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00010}00010 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00011}00011 \textcolor{comment}{Permission is granted to anyone to use this software for any purpose,}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00012}00012 \textcolor{comment}{including commercial applications, and to alter it and redistribute it}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00013}00013 \textcolor{comment}{freely, subject to the following restrictions:}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00014}00014 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00015}00015 \textcolor{comment}{   1. The origin of this software must not be misrepresented; you must not}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00016}00016 \textcolor{comment}{   claim that you wrote the original software. If you use this software}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00017}00017 \textcolor{comment}{   in a product, an acknowledgment in the product documentation would be}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00018}00018 \textcolor{comment}{   appreciated but is not required.}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00019}00019 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00020}00020 \textcolor{comment}{   2. Altered source versions must be plainly marked as such, and must not be}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00021}00021 \textcolor{comment}{   misrepresented as being the original software.}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00022}00022 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00023}00023 \textcolor{comment}{   3. This notice may not be removed or altered from any source}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00024}00024 \textcolor{comment}{   distribution.}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00025}00025 \textcolor{comment}{*/}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00026}00026 \textcolor{preprocessor}{\#include "{}uSynergy.h"{}}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00027}00027 \textcolor{preprocessor}{\#include <stdio.h>}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00028}00028 \textcolor{preprocessor}{\#include <string.h>}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00029}00029 }
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00030}00030 }
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00031}00031 }
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00032}00032 \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00033}00033 \textcolor{comment}{//  Internal helpers}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00034}00034 \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00035}00035 }
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00036}00036 }
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00037}00037 }
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00041}00041 \textcolor{keyword}{static} int16\_t sNetToNative16(\textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *\mbox{\hyperlink{classvalue}{value}})}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00042}00042 \{}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00043}00043 \textcolor{preprocessor}{\#ifdef USYNERGY\_LITTLE\_ENDIAN}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00044}00044     \textcolor{keywordflow}{return} \mbox{\hyperlink{classvalue}{value}}[1] | (\mbox{\hyperlink{classvalue}{value}}[0] << 8);}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00045}00045 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00046}00046     \textcolor{keywordflow}{return} \mbox{\hyperlink{classvalue}{value}}[0] | (\mbox{\hyperlink{classvalue}{value}}[1] << 8);}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00047}00047 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00048}00048 \}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00049}00049 }
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00050}00050 }
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00051}00051 }
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00055}00055 \textcolor{keyword}{static} int32\_t sNetToNative32(\textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *\mbox{\hyperlink{classvalue}{value}})}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00056}00056 \{}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00057}00057 \textcolor{preprocessor}{\#ifdef USYNERGY\_LITTLE\_ENDIAN}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00058}00058     \textcolor{keywordflow}{return} \mbox{\hyperlink{classvalue}{value}}[3] | (\mbox{\hyperlink{classvalue}{value}}[2] << 8) | (\mbox{\hyperlink{classvalue}{value}}[1] << 16) | (\mbox{\hyperlink{classvalue}{value}}[0] << 24);}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00059}00059 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00060}00060     \textcolor{keywordflow}{return} \mbox{\hyperlink{classvalue}{value}}[0] | (\mbox{\hyperlink{classvalue}{value}}[1] << 8) | (\mbox{\hyperlink{classvalue}{value}}[2] << 16) | (\mbox{\hyperlink{classvalue}{value}}[3] << 24);}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00061}00061 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00062}00062 \}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00063}00063 }
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00064}00064 }
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00065}00065 }
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00069}00069 \textcolor{keyword}{static} \textcolor{keywordtype}{void} sTrace(\mbox{\hyperlink{structu_synergy_context}{uSynergyContext}} *context, \textcolor{keyword}{const} \textcolor{keywordtype}{char}* text)}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00070}00070 \{}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00071}00071     \textcolor{comment}{// Don't trace if we don't have a trace function}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00072}00072     \textcolor{keywordflow}{if} (context-\/>m\_traceFunc != 0L)}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00073}00073         context-\/>m\_traceFunc(context-\/>m\_cookie, text);}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00074}00074 \}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00075}00075 }
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00076}00076 }
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00077}00077 }
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00081}00081 \textcolor{keyword}{static} \textcolor{keywordtype}{void} sAddString(\mbox{\hyperlink{structu_synergy_context}{uSynergyContext}} *context, \textcolor{keyword}{const} \textcolor{keywordtype}{char} *\textcolor{keywordtype}{string})}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00082}00082 \{}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00083}00083     \textcolor{keywordtype}{size\_t} len = strlen(\textcolor{keywordtype}{string});}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00084}00084     memcpy(context-\/>m\_replyCur, \textcolor{keywordtype}{string}, len);}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00085}00085     context-\/>m\_replyCur += len;}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00086}00086 \}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00087}00087 }
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00088}00088 }
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00089}00089 }
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00093}00093 \textcolor{keyword}{static} \textcolor{keywordtype}{void} sAddUInt8(\mbox{\hyperlink{structu_synergy_context}{uSynergyContext}} *context, uint8\_t \mbox{\hyperlink{classvalue}{value}})}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00094}00094 \{}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00095}00095     *context-\/>m\_replyCur++ = \mbox{\hyperlink{classvalue}{value}};}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00096}00096 \}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00097}00097 }
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00098}00098 }
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00099}00099 }
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00103}00103 \textcolor{keyword}{static} \textcolor{keywordtype}{void} sAddUInt16(\mbox{\hyperlink{structu_synergy_context}{uSynergyContext}} *context, uint16\_t \mbox{\hyperlink{classvalue}{value}})}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00104}00104 \{}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00105}00105     uint8\_t *reply = context-\/>m\_replyCur;}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00106}00106     *reply++ = (\mbox{\hyperlink{group__gtc__type__precision_ga93adf6dd9803408f3e3aaf9dedda352b}{uint8\_t}})(\mbox{\hyperlink{classvalue}{value}} >> 8);}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00107}00107     *reply++ = (\mbox{\hyperlink{group__gtc__type__precision_ga93adf6dd9803408f3e3aaf9dedda352b}{uint8\_t}})\mbox{\hyperlink{classvalue}{value}};}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00108}00108     context-\/>m\_replyCur = reply;}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00109}00109 \}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00110}00110 }
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00111}00111 }
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00112}00112 }
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00116}00116 \textcolor{keyword}{static} \textcolor{keywordtype}{void} sAddUInt32(\mbox{\hyperlink{structu_synergy_context}{uSynergyContext}} *context, uint32\_t \mbox{\hyperlink{classvalue}{value}})}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00117}00117 \{}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00118}00118     uint8\_t *reply = context-\/>m\_replyCur;}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00119}00119     *reply++ = (\mbox{\hyperlink{group__gtc__type__precision_ga93adf6dd9803408f3e3aaf9dedda352b}{uint8\_t}})(\mbox{\hyperlink{classvalue}{value}} >> 24);}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00120}00120     *reply++ = (\mbox{\hyperlink{group__gtc__type__precision_ga93adf6dd9803408f3e3aaf9dedda352b}{uint8\_t}})(\mbox{\hyperlink{classvalue}{value}} >> 16);}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00121}00121     *reply++ = (\mbox{\hyperlink{group__gtc__type__precision_ga93adf6dd9803408f3e3aaf9dedda352b}{uint8\_t}})(\mbox{\hyperlink{classvalue}{value}} >> 8);}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00122}00122     *reply++ = (\mbox{\hyperlink{group__gtc__type__precision_ga93adf6dd9803408f3e3aaf9dedda352b}{uint8\_t}})\mbox{\hyperlink{classvalue}{value}};}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00123}00123     context-\/>m\_replyCur = reply;}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00124}00124 \}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00125}00125 }
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00126}00126 }
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00127}00127 }
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00131}00131 \textcolor{keyword}{static} uSynergyBool sSendReply(\mbox{\hyperlink{structu_synergy_context}{uSynergyContext}} *context)}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00132}00132 \{}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00133}00133     \textcolor{comment}{// Set header size}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00134}00134     uint8\_t     *reply\_buf  = context-\/>m\_replyBuffer;}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00135}00135     uint32\_t    reply\_len   = (\mbox{\hyperlink{group__gtc__type__precision_ga822ca53a9ad412504532838906276a99}{uint32\_t}})(context-\/>m\_replyCur -\/ reply\_buf);              \textcolor{comment}{/* Total size of reply */}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00136}00136     uint32\_t    body\_len    = reply\_len -\/ 4;                                            \textcolor{comment}{/* Size of body */}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00137}00137     uSynergyBool ret;}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00138}00138     reply\_buf[0] = (\mbox{\hyperlink{group__gtc__type__precision_ga93adf6dd9803408f3e3aaf9dedda352b}{uint8\_t}})(body\_len >> 24);}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00139}00139     reply\_buf[1] = (\mbox{\hyperlink{group__gtc__type__precision_ga93adf6dd9803408f3e3aaf9dedda352b}{uint8\_t}})(body\_len >> 16);}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00140}00140     reply\_buf[2] = (\mbox{\hyperlink{group__gtc__type__precision_ga93adf6dd9803408f3e3aaf9dedda352b}{uint8\_t}})(body\_len >> 8);}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00141}00141     reply\_buf[3] = (\mbox{\hyperlink{group__gtc__type__precision_ga93adf6dd9803408f3e3aaf9dedda352b}{uint8\_t}})body\_len;}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00142}00142 }
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00143}00143     \textcolor{comment}{// Send reply}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00144}00144     ret = context-\/>m\_sendFunc(context-\/>m\_cookie, context-\/>m\_replyBuffer, reply\_len);}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00145}00145 }
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00146}00146     \textcolor{comment}{// Reset reply buffer write pointer}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00147}00147     context-\/>m\_replyCur = context-\/>m\_replyBuffer+4;}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00148}00148     \textcolor{keywordflow}{return} ret;}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00149}00149 \}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00150}00150 }
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00151}00151 }
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00152}00152 }
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00156}00156 \textcolor{keyword}{static} \textcolor{keywordtype}{void} sSendMouseCallback(\mbox{\hyperlink{structu_synergy_context}{uSynergyContext}} *context)}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00157}00157 \{}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00158}00158     \textcolor{comment}{// Skip if no callback is installed}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00159}00159     \textcolor{keywordflow}{if} (context-\/>m\_mouseCallback == 0L)}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00160}00160         \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00161}00161 }
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00162}00162     \textcolor{comment}{// Send callback}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00163}00163     context-\/>m\_mouseCallback(context-\/>m\_cookie, context-\/>m\_mouseX, context-\/>m\_mouseY, context-\/>m\_mouseWheelX,}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00164}00164         context-\/>m\_mouseWheelY, context-\/>m\_mouseButtonLeft, context-\/>m\_mouseButtonRight, context-\/>m\_mouseButtonMiddle);}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00165}00165 \}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00166}00166 }
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00167}00167 }
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00168}00168 }
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00172}00172 \textcolor{keyword}{static} \textcolor{keywordtype}{void} sSendKeyboardCallback(\mbox{\hyperlink{structu_synergy_context}{uSynergyContext}} *context, uint16\_t key, uint16\_t modifiers, uSynergyBool down, uSynergyBool \mbox{\hyperlink{group__gtx__wrap_ga809650c6310ea7c42666e918c117fb6f}{repeat}})}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00173}00173 \{}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00174}00174     \textcolor{comment}{// Skip if no callback is installed}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00175}00175     \textcolor{keywordflow}{if} (context-\/>m\_keyboardCallback == 0L)}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00176}00176         \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00177}00177 }
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00178}00178     \textcolor{comment}{// Send callback}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00179}00179     context-\/>m\_keyboardCallback(context-\/>m\_cookie, key, modifiers, down, \mbox{\hyperlink{group__gtx__wrap_ga809650c6310ea7c42666e918c117fb6f}{repeat}});}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00180}00180 \}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00181}00181 }
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00182}00182 }
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00183}00183 }
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00187}00187 \textcolor{keyword}{static} \textcolor{keywordtype}{void} sSendJoystickCallback(\mbox{\hyperlink{structu_synergy_context}{uSynergyContext}} *context, uint8\_t joyNum)}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00188}00188 \{}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00189}00189     int8\_t *sticks;}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00190}00190 }
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00191}00191     \textcolor{comment}{// Skip if no callback is installed}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00192}00192     \textcolor{keywordflow}{if} (context-\/>m\_joystickCallback == 0L)}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00193}00193         \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00194}00194 }
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00195}00195     \textcolor{comment}{// Send callback}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00196}00196     sticks = context-\/>m\_joystickSticks[joyNum];}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00197}00197     context-\/>m\_joystickCallback(context-\/>m\_cookie, joyNum, context-\/>m\_joystickButtons[joyNum], sticks[0], sticks[1], sticks[2], sticks[3]);}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00198}00198 \}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00199}00199 }
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00200}00200 }
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00201}00201 }
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00205}00205 \textcolor{preprocessor}{\#define USYNERGY\_IS\_PACKET(pkt\_id)  memcmp(message+4, pkt\_id, 4)==0}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00206}00206 \textcolor{keyword}{static} \textcolor{keywordtype}{void} sProcessMessage(\mbox{\hyperlink{structu_synergy_context}{uSynergyContext}} *context, \textcolor{keyword}{const} uint8\_t *message)}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00207}00207 \{}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00208}00208     \textcolor{comment}{// We have a packet!}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00209}00209     \textcolor{keywordflow}{if} (memcmp(message+4, \textcolor{stringliteral}{"{}Synergy"{}}, 7)==0)}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00210}00210     \{}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00211}00211         \textcolor{comment}{// Welcome message}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00212}00212         \textcolor{comment}{//      kMsgHello           = "{}Synergy\%2i\%2i"{}}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00213}00213         \textcolor{comment}{//      kMsgHelloBack       = "{}Synergy\%2i\%2i\%s"{}}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00214}00214         sAddString(context, \textcolor{stringliteral}{"{}Synergy"{}});}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00215}00215         sAddUInt16(context, USYNERGY\_PROTOCOL\_MAJOR);}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00216}00216         sAddUInt16(context, USYNERGY\_PROTOCOL\_MINOR);}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00217}00217         sAddUInt32(context, (uint32\_t)strlen(context-\/>m\_clientName));}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00218}00218         sAddString(context, context-\/>m\_clientName);}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00219}00219         \textcolor{keywordflow}{if} (!sSendReply(context))}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00220}00220         \{}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00221}00221             \textcolor{comment}{// Send reply failed, let's try to reconnect}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00222}00222             sTrace(context, \textcolor{stringliteral}{"{}SendReply failed, trying to reconnect in a second"{}});}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00223}00223             context-\/>m\_connected = USYNERGY\_FALSE;}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00224}00224             context-\/>m\_sleepFunc(context-\/>m\_cookie, 1000);}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00225}00225         \}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00226}00226         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00227}00227         \{}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00228}00228             \textcolor{comment}{// Let's assume we're connected}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00229}00229             \textcolor{keywordtype}{char} \mbox{\hyperlink{classbuffer}{buffer}}[256+1];}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00230}00230             sprintf(\mbox{\hyperlink{classbuffer}{buffer}}, \textcolor{stringliteral}{"{}Connected as client \(\backslash\)"{}\%s\(\backslash\)"{}"{}}, context-\/>m\_clientName);}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00231}00231             sTrace(context, \mbox{\hyperlink{classbuffer}{buffer}});}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00232}00232             context-\/>m\_hasReceivedHello = USYNERGY\_TRUE;}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00233}00233         \}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00234}00234         \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00235}00235     \}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00236}00236     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (USYNERGY\_IS\_PACKET(\textcolor{stringliteral}{"{}QINF"{}}))}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00237}00237     \{}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00238}00238         \textcolor{comment}{// Screen info. Reply with DINF}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00239}00239         \textcolor{comment}{//      kMsgQInfo           = "{}QINF"{}}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00240}00240         \textcolor{comment}{//      kMsgDInfo           = "{}DINF\%2i\%2i\%2i\%2i\%2i\%2i\%2i"{}}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00241}00241         uint16\_t x = 0, y = 0, warp = 0;}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00242}00242         sAddString(context, \textcolor{stringliteral}{"{}DINF"{}});}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00243}00243         sAddUInt16(context, x);}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00244}00244         sAddUInt16(context, y);}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00245}00245         sAddUInt16(context, context-\/>m\_clientWidth);}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00246}00246         sAddUInt16(context, context-\/>m\_clientHeight);}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00247}00247         sAddUInt16(context, warp);}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00248}00248         sAddUInt16(context, 0);     \textcolor{comment}{// mx?}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00249}00249         sAddUInt16(context, 0);     \textcolor{comment}{// my?}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00250}00250         sSendReply(context);}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00251}00251         \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00252}00252     \}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00253}00253     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (USYNERGY\_IS\_PACKET(\textcolor{stringliteral}{"{}CIAK"{}}))}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00254}00254     \{}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00255}00255         \textcolor{comment}{// Do nothing?}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00256}00256         \textcolor{comment}{//      kMsgCInfoAck        = "{}CIAK"{}}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00257}00257         \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00258}00258     \}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00259}00259     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (USYNERGY\_IS\_PACKET(\textcolor{stringliteral}{"{}CROP"{}}))}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00260}00260     \{}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00261}00261         \textcolor{comment}{// Do nothing?}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00262}00262         \textcolor{comment}{//      kMsgCResetOptions   = "{}CROP"{}}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00263}00263         \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00264}00264     \}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00265}00265     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (USYNERGY\_IS\_PACKET(\textcolor{stringliteral}{"{}CINN"{}}))}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00266}00266     \{}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00267}00267         \textcolor{comment}{// Screen enter. Reply with CNOP}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00268}00268         \textcolor{comment}{//      kMsgCEnter          = "{}CINN\%2i\%2i\%4i\%2i"{}}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00269}00269 }
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00270}00270         \textcolor{comment}{// Obtain the Synergy sequence number}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00271}00271         context-\/>m\_sequenceNumber = sNetToNative32(message + 12);}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00272}00272         context-\/>m\_isCaptured = USYNERGY\_TRUE;}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00273}00273 }
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00274}00274         \textcolor{comment}{// Call callback}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00275}00275         \textcolor{keywordflow}{if} (context-\/>m\_screenActiveCallback != 0L)}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00276}00276             context-\/>m\_screenActiveCallback(context-\/>m\_cookie, USYNERGY\_TRUE);}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00277}00277     \}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00278}00278     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (USYNERGY\_IS\_PACKET(\textcolor{stringliteral}{"{}COUT"{}}))}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00279}00279     \{}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00280}00280         \textcolor{comment}{// Screen leave}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00281}00281         \textcolor{comment}{//      kMsgCLeave          = "{}COUT"{}}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00282}00282         context-\/>m\_isCaptured = USYNERGY\_FALSE;}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00283}00283 }
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00284}00284         \textcolor{comment}{// Call callback}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00285}00285         \textcolor{keywordflow}{if} (context-\/>m\_screenActiveCallback != 0L)}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00286}00286             context-\/>m\_screenActiveCallback(context-\/>m\_cookie, USYNERGY\_FALSE);}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00287}00287     \}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00288}00288     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (USYNERGY\_IS\_PACKET(\textcolor{stringliteral}{"{}DMDN"{}}))}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00289}00289     \{}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00290}00290         \textcolor{comment}{// Mouse down}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00291}00291         \textcolor{comment}{//      kMsgDMouseDown      = "{}DMDN\%1i"{}}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00292}00292         \textcolor{keywordtype}{char} btn = message[8]-\/1;}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00293}00293         \textcolor{keywordflow}{if} (btn==2)}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00294}00294             context-\/>m\_mouseButtonRight     = USYNERGY\_TRUE;}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00295}00295         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (btn==1)}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00296}00296             context-\/>m\_mouseButtonMiddle    = USYNERGY\_TRUE;}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00297}00297         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00298}00298             context-\/>m\_mouseButtonLeft      = USYNERGY\_TRUE;}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00299}00299         sSendMouseCallback(context);}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00300}00300     \}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00301}00301     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (USYNERGY\_IS\_PACKET(\textcolor{stringliteral}{"{}DMUP"{}}))}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00302}00302     \{}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00303}00303         \textcolor{comment}{// Mouse up}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00304}00304         \textcolor{comment}{//      kMsgDMouseUp        = "{}DMUP\%1i"{}}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00305}00305         \textcolor{keywordtype}{char} btn = message[8]-\/1;}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00306}00306         \textcolor{keywordflow}{if} (btn==2)}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00307}00307             context-\/>m\_mouseButtonRight     = USYNERGY\_FALSE;}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00308}00308         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (btn==1)}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00309}00309             context-\/>m\_mouseButtonMiddle    = USYNERGY\_FALSE;}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00310}00310         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00311}00311             context-\/>m\_mouseButtonLeft      = USYNERGY\_FALSE;}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00312}00312         sSendMouseCallback(context);}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00313}00313     \}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00314}00314     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (USYNERGY\_IS\_PACKET(\textcolor{stringliteral}{"{}DMMV"{}}))}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00315}00315     \{}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00316}00316         \textcolor{comment}{// Mouse move. Reply with CNOP}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00317}00317         \textcolor{comment}{//      kMsgDMouseMove      = "{}DMMV\%2i\%2i"{}}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00318}00318         context-\/>m\_mouseX = sNetToNative16(message+8);}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00319}00319         context-\/>m\_mouseY = sNetToNative16(message+10);}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00320}00320         sSendMouseCallback(context);}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00321}00321     \}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00322}00322     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (USYNERGY\_IS\_PACKET(\textcolor{stringliteral}{"{}DMWM"{}}))}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00323}00323     \{}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00324}00324         \textcolor{comment}{// Mouse wheel}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00325}00325         \textcolor{comment}{//      kMsgDMouseWheel     = "{}DMWM\%2i\%2i"{}}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00326}00326         \textcolor{comment}{//      kMsgDMouseWheel1\_0  = "{}DMWM\%2i"{}}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00327}00327         context-\/>m\_mouseWheelX += sNetToNative16(message+8);}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00328}00328         context-\/>m\_mouseWheelY += sNetToNative16(message+10);}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00329}00329         sSendMouseCallback(context);}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00330}00330     \}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00331}00331     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (USYNERGY\_IS\_PACKET(\textcolor{stringliteral}{"{}DKDN"{}}))}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00332}00332     \{}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00333}00333         \textcolor{comment}{// Key down}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00334}00334         \textcolor{comment}{//      kMsgDKeyDown        = "{}DKDN\%2i\%2i\%2i"{}}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00335}00335         \textcolor{comment}{//      kMsgDKeyDown1\_0     = "{}DKDN\%2i\%2i"{}}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00336}00336         \textcolor{comment}{//uint16\_t id = sNetToNative16(message+8);}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00337}00337         uint16\_t mod = sNetToNative16(message+10);}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00338}00338         uint16\_t key = sNetToNative16(message+12);}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00339}00339         sSendKeyboardCallback(context, key, mod, USYNERGY\_TRUE, USYNERGY\_FALSE);}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00340}00340     \}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00341}00341     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (USYNERGY\_IS\_PACKET(\textcolor{stringliteral}{"{}DKRP"{}}))}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00342}00342     \{}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00343}00343         \textcolor{comment}{// Key repeat}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00344}00344         \textcolor{comment}{//      kMsgDKeyRepeat      = "{}DKRP\%2i\%2i\%2i\%2i"{}}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00345}00345         \textcolor{comment}{//      kMsgDKeyRepeat1\_0   = "{}DKRP\%2i\%2i\%2i"{}}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00346}00346         uint16\_t mod = sNetToNative16(message+10);}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00347}00347 \textcolor{comment}{//      uint16\_t count = sNetToNative16(message+12);}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00348}00348         uint16\_t key = sNetToNative16(message+14);}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00349}00349         sSendKeyboardCallback(context, key, mod, USYNERGY\_TRUE, USYNERGY\_TRUE);}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00350}00350     \}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00351}00351     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (USYNERGY\_IS\_PACKET(\textcolor{stringliteral}{"{}DKUP"{}}))}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00352}00352     \{}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00353}00353         \textcolor{comment}{// Key up}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00354}00354         \textcolor{comment}{//      kMsgDKeyUp          = "{}DKUP\%2i\%2i\%2i"{}}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00355}00355         \textcolor{comment}{//      kMsgDKeyUp1\_0       = "{}DKUP\%2i\%2i"{}}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00356}00356         \textcolor{comment}{//uint16 id=Endian::sNetToNative(sbuf[4]);}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00357}00357         uint16\_t mod = sNetToNative16(message+10);}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00358}00358         uint16\_t key = sNetToNative16(message+12);}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00359}00359         sSendKeyboardCallback(context, key, mod, USYNERGY\_FALSE, USYNERGY\_FALSE);}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00360}00360     \}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00361}00361     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (USYNERGY\_IS\_PACKET(\textcolor{stringliteral}{"{}DGBT"{}}))}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00362}00362     \{}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00363}00363         \textcolor{comment}{// Joystick buttons}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00364}00364         \textcolor{comment}{//      kMsgDGameButtons    = "{}DGBT\%1i\%2i"{};}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00365}00365         uint8\_t joy\_num = message[8];}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00366}00366         \textcolor{keywordflow}{if} (joy\_num<USYNERGY\_NUM\_JOYSTICKS)}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00367}00367         \{}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00368}00368             \textcolor{comment}{// Copy button state, then send callback}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00369}00369             context-\/>m\_joystickButtons[joy\_num] = (message[9] << 8) | message[10];}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00370}00370             sSendJoystickCallback(context, joy\_num);}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00371}00371         \}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00372}00372     \}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00373}00373     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (USYNERGY\_IS\_PACKET(\textcolor{stringliteral}{"{}DGST"{}}))}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00374}00374     \{}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00375}00375         \textcolor{comment}{// Joystick sticks}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00376}00376         \textcolor{comment}{//      kMsgDGameSticks     = "{}DGST\%1i\%1i\%1i\%1i\%1i"{};}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00377}00377         uint8\_t joy\_num = message[8];}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00378}00378         \textcolor{keywordflow}{if} (joy\_num<USYNERGY\_NUM\_JOYSTICKS)}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00379}00379         \{}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00380}00380             \textcolor{comment}{// Copy stick state, then send callback}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00381}00381             memcpy(context-\/>m\_joystickSticks[joy\_num], message+9, 4);}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00382}00382             sSendJoystickCallback(context, joy\_num);}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00383}00383         \}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00384}00384     \}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00385}00385     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (USYNERGY\_IS\_PACKET(\textcolor{stringliteral}{"{}DSOP"{}}))}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00386}00386     \{}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00387}00387         \textcolor{comment}{// Set options}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00388}00388         \textcolor{comment}{//      kMsgDSetOptions     = "{}DSOP\%4I"{}}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00389}00389     \}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00390}00390     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (USYNERGY\_IS\_PACKET(\textcolor{stringliteral}{"{}CALV"{}}))}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00391}00391     \{}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00392}00392         \textcolor{comment}{// Keepalive, reply with CALV and then CNOP}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00393}00393         \textcolor{comment}{//      kMsgCKeepAlive      = "{}CALV"{}}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00394}00394         sAddString(context, \textcolor{stringliteral}{"{}CALV"{}});}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00395}00395         sSendReply(context);}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00396}00396         \textcolor{comment}{// now reply with CNOP}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00397}00397     \}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00398}00398     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (USYNERGY\_IS\_PACKET(\textcolor{stringliteral}{"{}DCLP"{}}))}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00399}00399     \{}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00400}00400         \textcolor{comment}{// Clipboard message}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00401}00401         \textcolor{comment}{//      kMsgDClipboard      = "{}DCLP\%1i\%4i\%s"{}}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00402}00402         \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00403}00403         \textcolor{comment}{// The clipboard message contains:}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00404}00404         \textcolor{comment}{//      1 uint32:   The size of the message}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00405}00405         \textcolor{comment}{//      4 chars:    The identifier ("{}DCLP"{})}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00406}00406         \textcolor{comment}{//      1 uint8:    The clipboard index}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00407}00407         \textcolor{comment}{//      1 uint32:   The sequence number. It's zero, because this message is always coming from the server?}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00408}00408         \textcolor{comment}{//      1 uint32:   The total size of the remaining 'string' (as per the Synergy \%s string format (which is 1 uint32 for size followed by a char buffer (not necessarily null terminated)).}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00409}00409         \textcolor{comment}{//      1 uint32:   The number of formats present in the message}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00410}00410         \textcolor{comment}{// And then 'number of formats' times the following:}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00411}00411         \textcolor{comment}{//      1 uint32:   The format of the clipboard data}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00412}00412         \textcolor{comment}{//      1 uint32:   The size n of the clipboard data}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00413}00413         \textcolor{comment}{//      n uint8:    The clipboard data}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00414}00414         \textcolor{keyword}{const} uint8\_t * parse\_msg   = message+17;}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00415}00415         uint32\_t        num\_formats = sNetToNative32(parse\_msg);}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00416}00416         parse\_msg += 4;}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00417}00417         \textcolor{keywordflow}{for} (; num\_formats; num\_formats-\/-\/)}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00418}00418         \{}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00419}00419             \textcolor{comment}{// Parse clipboard format header}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00420}00420             uint32\_t format = sNetToNative32(parse\_msg);}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00421}00421             uint32\_t size   = sNetToNative32(parse\_msg+4);}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00422}00422             parse\_msg += 8;}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00423}00423             }
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00424}00424             \textcolor{comment}{// Call callback}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00425}00425             \textcolor{keywordflow}{if} (context-\/>m\_clipboardCallback)}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00426}00426                 context-\/>m\_clipboardCallback(context-\/>m\_cookie, format, parse\_msg, size);}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00427}00427 }
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00428}00428             parse\_msg += size;}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00429}00429         \}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00430}00430     \}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00431}00431     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00432}00432     \{}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00433}00433         \textcolor{comment}{// Unknown packet, could be any of these}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00434}00434         \textcolor{comment}{//      kMsgCNoop           = "{}CNOP"{}}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00435}00435         \textcolor{comment}{//      kMsgCClose          = "{}CBYE"{}}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00436}00436         \textcolor{comment}{//      kMsgCClipboard      = "{}CCLP\%1i\%4i"{}}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00437}00437         \textcolor{comment}{//      kMsgCScreenSaver    = "{}CSEC\%1i"{}}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00438}00438         \textcolor{comment}{//      kMsgDKeyRepeat      = "{}DKRP\%2i\%2i\%2i\%2i"{}}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00439}00439         \textcolor{comment}{//      kMsgDKeyRepeat1\_0   = "{}DKRP\%2i\%2i\%2i"{}}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00440}00440         \textcolor{comment}{//      kMsgDMouseRelMove   = "{}DMRM\%2i\%2i"{}}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00441}00441         \textcolor{comment}{//      kMsgEIncompatible   = "{}EICV\%2i\%2i"{}}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00442}00442         \textcolor{comment}{//      kMsgEBusy           = "{}EBSY"{}}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00443}00443         \textcolor{comment}{//      kMsgEUnknown        = "{}EUNK"{}}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00444}00444         \textcolor{comment}{//      kMsgEBad            = "{}EBAD"{}}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00445}00445         \textcolor{keywordtype}{char} \mbox{\hyperlink{classbuffer}{buffer}}[64];}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00446}00446         sprintf(\mbox{\hyperlink{classbuffer}{buffer}}, \textcolor{stringliteral}{"{}Unknown packet '\%c\%c\%c\%c'"{}}, message[4], message[5], message[6], message[7]);}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00447}00447         sTrace(context, \mbox{\hyperlink{classbuffer}{buffer}});}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00448}00448         \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00449}00449     \}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00450}00450 }
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00451}00451     \textcolor{comment}{// Reply with CNOP maybe?}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00452}00452     sAddString(context, \textcolor{stringliteral}{"{}CNOP"{}});}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00453}00453     sSendReply(context);}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00454}00454 \}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00455}00455 \textcolor{preprocessor}{\#undef USYNERGY\_IS\_PACKET}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00456}00456 }
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00457}00457 }
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00458}00458 }
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00462}00462 \textcolor{keyword}{static} \textcolor{keywordtype}{void} sSetDisconnected(\mbox{\hyperlink{structu_synergy_context}{uSynergyContext}} *context)}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00463}00463 \{}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00464}00464     context-\/>m\_connected        = USYNERGY\_FALSE;}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00465}00465     context-\/>m\_hasReceivedHello = USYNERGY\_FALSE;}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00466}00466     context-\/>m\_isCaptured       = USYNERGY\_FALSE;}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00467}00467     context-\/>m\_replyCur         = context-\/>m\_replyBuffer + 4;}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00468}00468     context-\/>m\_sequenceNumber   = 0;}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00469}00469 \}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00470}00470 }
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00471}00471 }
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00472}00472 }
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00476}00476 \textcolor{keyword}{static} \textcolor{keywordtype}{void} sUpdateContext(\mbox{\hyperlink{structu_synergy_context}{uSynergyContext}} *context)}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00477}00477 \{}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00478}00478     \textcolor{comment}{/* Receive data (blocking) */}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00479}00479     \textcolor{keywordtype}{int} receive\_size = USYNERGY\_RECEIVE\_BUFFER\_SIZE -\/ context-\/>m\_receiveOfs;}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00480}00480     \textcolor{keywordtype}{int} num\_received = 0;}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00481}00481     \textcolor{keywordtype}{int} packlen = 0;}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00482}00482     \textcolor{keywordflow}{if} (context-\/>m\_receiveFunc(context-\/>m\_cookie, context-\/>m\_receiveBuffer + context-\/>m\_receiveOfs, receive\_size, \&num\_received) == USYNERGY\_FALSE)}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00483}00483     \{}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00484}00484         \textcolor{comment}{/* Receive failed, let's try to reconnect */}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00485}00485         \textcolor{keywordtype}{char} \mbox{\hyperlink{classbuffer}{buffer}}[128];}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00486}00486         sprintf(\mbox{\hyperlink{classbuffer}{buffer}}, \textcolor{stringliteral}{"{}Receive failed (\%d bytes asked, \%d bytes received), trying to reconnect in a second"{}}, receive\_size, num\_received);}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00487}00487         sTrace(context, \mbox{\hyperlink{classbuffer}{buffer}});}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00488}00488         sSetDisconnected(context);}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00489}00489         context-\/>m\_sleepFunc(context-\/>m\_cookie, 1000);}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00490}00490         \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00491}00491     \}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00492}00492     context-\/>m\_receiveOfs += num\_received;}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00493}00493 }
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00494}00494     \textcolor{comment}{/*  If we didn't receive any data then we're probably still polling to get connected and}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00495}00495 \textcolor{comment}{        therefore not getting any data back. To avoid overloading the system with a Synergy}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00496}00496 \textcolor{comment}{        thread that would hammer on polling, we let it rest for a bit if there's no data. */}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00497}00497     \textcolor{keywordflow}{if} (num\_received == 0)}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00498}00498         context-\/>m\_sleepFunc(context-\/>m\_cookie, 500);}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00499}00499 }
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00500}00500     \textcolor{comment}{/* Check for timeouts */}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00501}00501     \textcolor{keywordflow}{if} (context-\/>m\_hasReceivedHello)}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00502}00502     \{}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00503}00503         uint32\_t cur\_time = context-\/>m\_getTimeFunc();}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00504}00504         \textcolor{keywordflow}{if} (num\_received == 0)}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00505}00505         \{}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00506}00506             \textcolor{comment}{/* Timeout after 2 secs of inactivity (we received no CALV) */}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00507}00507             \textcolor{keywordflow}{if} ((cur\_time -\/ context-\/>m\_lastMessageTime) > USYNERGY\_IDLE\_TIMEOUT)}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00508}00508                 sSetDisconnected(context);}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00509}00509         \}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00510}00510         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00511}00511             context-\/>m\_lastMessageTime = cur\_time;}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00512}00512     \}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00513}00513 }
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00514}00514     \textcolor{comment}{/* Eat packets */}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00515}00515     \textcolor{keywordflow}{for} (;;)}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00516}00516     \{}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00517}00517         \textcolor{comment}{/* Grab packet length and bail out if the packet goes beyond the end of the buffer */}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00518}00518         packlen = sNetToNative32(context-\/>m\_receiveBuffer);}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00519}00519         \textcolor{keywordflow}{if} (packlen+4 > context-\/>m\_receiveOfs)}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00520}00520             \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00521}00521 }
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00522}00522         \textcolor{comment}{/* Process message */}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00523}00523         sProcessMessage(context, context-\/>m\_receiveBuffer);}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00524}00524 }
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00525}00525         \textcolor{comment}{/* Move packet to front of buffer */}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00526}00526         memmove(context-\/>m\_receiveBuffer, context-\/>m\_receiveBuffer+packlen+4, context-\/>m\_receiveOfs-\/packlen-\/4);}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00527}00527         context-\/>m\_receiveOfs -\/= packlen+4;}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00528}00528     \}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00529}00529 }
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00530}00530     \textcolor{comment}{/* Throw away over-\/sized packets */}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00531}00531     \textcolor{keywordflow}{if} (packlen > USYNERGY\_RECEIVE\_BUFFER\_SIZE)}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00532}00532     \{}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00533}00533         \textcolor{comment}{/* Oversized packet, ditch tail end */}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00534}00534         \textcolor{keywordtype}{char} \mbox{\hyperlink{classbuffer}{buffer}}[128];}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00535}00535         sprintf(\mbox{\hyperlink{classbuffer}{buffer}}, \textcolor{stringliteral}{"{}Oversized packet: '\%c\%c\%c\%c' (length \%d)"{}}, context-\/>m\_receiveBuffer[4], context-\/>m\_receiveBuffer[5], context-\/>m\_receiveBuffer[6], context-\/>m\_receiveBuffer[7], packlen);}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00536}00536         sTrace(context, \mbox{\hyperlink{classbuffer}{buffer}});}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00537}00537         num\_received = context-\/>m\_receiveOfs-\/4; \textcolor{comment}{// 4 bytes for the size field}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00538}00538         \textcolor{keywordflow}{while} (num\_received != packlen)}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00539}00539         \{}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00540}00540             \textcolor{keywordtype}{int} buffer\_left = packlen -\/ num\_received;}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00541}00541             \textcolor{keywordtype}{int} to\_receive = buffer\_left < USYNERGY\_RECEIVE\_BUFFER\_SIZE ? buffer\_left : USYNERGY\_RECEIVE\_BUFFER\_SIZE;}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00542}00542             \textcolor{keywordtype}{int} ditch\_received = 0;}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00543}00543             \textcolor{keywordflow}{if} (context-\/>m\_receiveFunc(context-\/>m\_cookie, context-\/>m\_receiveBuffer, to\_receive, \&ditch\_received) == USYNERGY\_FALSE)}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00544}00544             \{}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00545}00545                 \textcolor{comment}{/* Receive failed, let's try to reconnect */}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00546}00546                 sTrace(context, \textcolor{stringliteral}{"{}Receive failed, trying to reconnect in a second"{}});}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00547}00547                 sSetDisconnected(context);}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00548}00548                 context-\/>m\_sleepFunc(context-\/>m\_cookie, 1000);}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00549}00549                 \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00550}00550             \}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00551}00551             \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00552}00552             \{}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00553}00553                 num\_received += ditch\_received;}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00554}00554             \}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00555}00555         \}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00556}00556         context-\/>m\_receiveOfs = 0;}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00557}00557     \}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00558}00558 \}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00559}00559 }
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00560}00560 }
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00561}00561 \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00562}00562 \textcolor{comment}{//  Public interface}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00563}00563 \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00564}00564 }
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00565}00565 }
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00566}00566 }
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00570}00570 \textcolor{keywordtype}{void} uSynergyInit(\mbox{\hyperlink{structu_synergy_context}{uSynergyContext}} *context)}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00571}00571 \{}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00572}00572     \textcolor{comment}{/* Zero memory */}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00573}00573     memset(context, 0, \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structu_synergy_context}{uSynergyContext}}));}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00574}00574 }
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00575}00575     \textcolor{comment}{/* Initialize to default state */}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00576}00576     sSetDisconnected(context);}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00577}00577 \}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00578}00578 }
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00579}00579 }
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00583}00583 \textcolor{keywordtype}{void} uSynergyUpdate(\mbox{\hyperlink{structu_synergy_context}{uSynergyContext}} *context)}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00584}00584 \{}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00585}00585     \textcolor{keywordflow}{if} (context-\/>m\_connected)}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00586}00586     \{}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00587}00587         \textcolor{comment}{/* Update context, receive data, call callbacks */}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00588}00588         sUpdateContext(context);}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00589}00589     \}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00590}00590     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00591}00591     \{}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00592}00592         \textcolor{comment}{/* Try to connect */}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00593}00593         \textcolor{keywordflow}{if} (context-\/>m\_connectFunc(context-\/>m\_cookie))}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00594}00594             context-\/>m\_connected = USYNERGY\_TRUE;}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00595}00595     \}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00596}00596 \}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00597}00597 }
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00598}00598 }
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00599}00599 }
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00603}00603 \textcolor{keywordtype}{void} uSynergySendClipboard(\mbox{\hyperlink{structu_synergy_context}{uSynergyContext}} *context, \textcolor{keyword}{const} \textcolor{keywordtype}{char} *text)}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00604}00604 \{}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00605}00605     \textcolor{comment}{// Calculate maximum size that will fit in a reply packet}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00606}00606     uint32\_t overhead\_size =    4 +                 \textcolor{comment}{/* Message size */}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00607}00607                                 4 +                 \textcolor{comment}{/* Message ID */}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00608}00608                                 1 +                 \textcolor{comment}{/* Clipboard index */}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00609}00609                                 4 +                 \textcolor{comment}{/* Sequence number */}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00610}00610                                 4 +                 \textcolor{comment}{/* Rest of message size (because it's a Synergy string from here on) */}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00611}00611                                 4 +                 \textcolor{comment}{/* Number of clipboard formats */}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00612}00612                                 4 +                 \textcolor{comment}{/* Clipboard format */}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00613}00613                                 4;                  \textcolor{comment}{/* Clipboard data length */}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00614}00614     uint32\_t max\_length = USYNERGY\_REPLY\_BUFFER\_SIZE -\/ overhead\_size;}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00615}00615     }
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00616}00616     \textcolor{comment}{// Clip text to max length}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00617}00617     uint32\_t text\_length = (\mbox{\hyperlink{group__gtc__type__precision_ga822ca53a9ad412504532838906276a99}{uint32\_t}})strlen(text);}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00618}00618     \textcolor{keywordflow}{if} (text\_length > max\_length)}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00619}00619     \{}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00620}00620         \textcolor{keywordtype}{char} \mbox{\hyperlink{classbuffer}{buffer}}[128];}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00621}00621         sprintf(\mbox{\hyperlink{classbuffer}{buffer}}, \textcolor{stringliteral}{"{}Clipboard buffer too small, clipboard truncated at \%d characters"{}}, max\_length);}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00622}00622         sTrace(context, \mbox{\hyperlink{classbuffer}{buffer}});}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00623}00623         text\_length = max\_length;}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00624}00624     \}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00625}00625 }
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00626}00626     \textcolor{comment}{// Assemble packet}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00627}00627     sAddString(context, \textcolor{stringliteral}{"{}DCLP"{}});}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00628}00628     sAddUInt8(context, 0);                          \textcolor{comment}{/* Clipboard index */}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00629}00629     sAddUInt32(context, context-\/>m\_sequenceNumber);}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00630}00630     sAddUInt32(context, 4+4+4+text\_length);         \textcolor{comment}{/* Rest of message size: numFormats, format, length, data */}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00631}00631     sAddUInt32(context, 1);                         \textcolor{comment}{/* Number of formats (only text for now) */}}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00632}00632     sAddUInt32(context, USYNERGY\_CLIPBOARD\_FORMAT\_TEXT);}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00633}00633     sAddUInt32(context, text\_length);}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00634}00634     sAddString(context, text);}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00635}00635     sSendReply(context);}
\DoxyCodeLine{\Hypertarget{u_synergy_8c_source_l00636}00636 \}}

\end{DoxyCode}
