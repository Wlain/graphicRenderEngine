\hypertarget{test__async_8cpp_source}{}\doxysection{test\+\_\+async.\+cpp}
\label{test__async_8cpp_source}\index{/Users/cwb/developer/learning/graphicRenderEngine/ceres/3rdparty/spdlog/tests/test\_async.cpp@{/Users/cwb/developer/learning/graphicRenderEngine/ceres/3rdparty/spdlog/tests/test\_async.cpp}}

\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00001}00001 \textcolor{preprocessor}{\#include "{}includes.h"{}}}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00002}00002 \textcolor{preprocessor}{\#include "{}spdlog/async.h"{}}}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00003}00003 \textcolor{preprocessor}{\#include "{}spdlog/sinks/basic\_file\_sink.h"{}}}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00004}00004 \textcolor{preprocessor}{\#include "{}test\_sink.h"{}}}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00005}00005 }
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00006}00006 \textcolor{preprocessor}{\#define TEST\_FILENAME "{}test\_logs/async\_test.log"{}}}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00007}00007 }
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00008}00008 TEST\_CASE(\textcolor{stringliteral}{"{}basic async test "{}}, \textcolor{stringliteral}{"{}[async]"{}})}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00009}00009 \{}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00010}00010     \textcolor{keyword}{auto} test\_sink = std::make\_shared<spdlog::sinks::test\_sink\_mt>();}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00011}00011     \textcolor{keywordtype}{size\_t} overrun\_counter = 0;}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00012}00012     \textcolor{keywordtype}{size\_t} queue\_size = 128;}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00013}00013     \textcolor{keywordtype}{size\_t} messages = 256;}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00014}00014     \{}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00015}00015         \textcolor{keyword}{auto} tp = std::make\_shared<spdlog::details::thread\_pool>(queue\_size, 1);}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00016}00016         \textcolor{keyword}{auto} logger = std::make\_shared<spdlog::async\_logger>(\textcolor{stringliteral}{"{}as"{}}, test\_sink, tp, spdlog::async\_overflow\_policy::block);}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00017}00017         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < messages; i++)}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00018}00018         \{}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00019}00019             logger-\/>info(\textcolor{stringliteral}{"{}Hello message \#\{\}"{}}, i);}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00020}00020         \}}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00021}00021         logger-\/>flush();}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00022}00022         overrun\_counter = tp-\/>overrun\_counter();}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00023}00023     \}}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00024}00024     REQUIRE(test\_sink-\/>msg\_counter() == messages);}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00025}00025     REQUIRE(test\_sink-\/>flush\_counter() == 1);}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00026}00026     REQUIRE(overrun\_counter == 0);}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00027}00027 \}}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00028}00028 }
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00029}00029 TEST\_CASE(\textcolor{stringliteral}{"{}discard policy "{}}, \textcolor{stringliteral}{"{}[async]"{}})}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00030}00030 \{}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00031}00031     \textcolor{keyword}{auto} test\_sink = std::make\_shared<spdlog::sinks::test\_sink\_mt>();}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00032}00032     test\_sink-\/>set\_delay(std::chrono::milliseconds(1));}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00033}00033     \textcolor{keywordtype}{size\_t} queue\_size = 4;}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00034}00034     \textcolor{keywordtype}{size\_t} messages = 1024;}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00035}00035 }
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00036}00036     \textcolor{keyword}{auto} tp = std::make\_shared<spdlog::details::thread\_pool>(queue\_size, 1);}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00037}00037     \textcolor{keyword}{auto} logger = std::make\_shared<spdlog::async\_logger>(\textcolor{stringliteral}{"{}as"{}}, test\_sink, tp, spdlog::async\_overflow\_policy::overrun\_oldest);}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00038}00038     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < messages; i++)}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00039}00039     \{}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00040}00040         logger-\/>info(\textcolor{stringliteral}{"{}Hello message"{}});}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00041}00041     \}}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00042}00042     REQUIRE(test\_sink-\/>msg\_counter() < messages);}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00043}00043     REQUIRE(tp-\/>overrun\_counter() > 0);}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00044}00044 \}}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00045}00045 }
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00046}00046 TEST\_CASE(\textcolor{stringliteral}{"{}discard policy using factory "{}}, \textcolor{stringliteral}{"{}[async]"{}})}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00047}00047 \{}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00048}00048     \textcolor{keywordtype}{size\_t} queue\_size = 4;}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00049}00049     \textcolor{keywordtype}{size\_t} messages = 1024;}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00050}00050     spdlog::init\_thread\_pool(queue\_size, 1);}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00051}00051 }
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00052}00052     \textcolor{keyword}{auto} logger = spdlog::create\_async\_nb<spdlog::sinks::test\_sink\_mt>(\textcolor{stringliteral}{"{}as2"{}});}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00053}00053     \textcolor{keyword}{auto} test\_sink = std::static\_pointer\_cast<spdlog::sinks::test\_sink\_mt>(logger-\/>sinks()[0]);}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00054}00054     test\_sink-\/>set\_delay(std::chrono::milliseconds(3));}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00055}00055 }
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00056}00056     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < messages; i++)}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00057}00057     \{}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00058}00058         logger-\/>info(\textcolor{stringliteral}{"{}Hello message"{}});}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00059}00059     \}}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00060}00060 }
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00061}00061     REQUIRE(test\_sink-\/>msg\_counter() < messages);}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00062}00062     spdlog::drop\_all();}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00063}00063 \}}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00064}00064 }
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00065}00065 TEST\_CASE(\textcolor{stringliteral}{"{}flush"{}}, \textcolor{stringliteral}{"{}[async]"{}})}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00066}00066 \{}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00067}00067     \textcolor{keyword}{auto} test\_sink = std::make\_shared<spdlog::sinks::test\_sink\_mt>();}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00068}00068     \textcolor{keywordtype}{size\_t} queue\_size = 256;}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00069}00069     \textcolor{keywordtype}{size\_t} messages = 256;}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00070}00070     \{}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00071}00071         \textcolor{keyword}{auto} tp = std::make\_shared<spdlog::details::thread\_pool>(queue\_size, 1);}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00072}00072         \textcolor{keyword}{auto} logger = std::make\_shared<spdlog::async\_logger>(\textcolor{stringliteral}{"{}as"{}}, test\_sink, tp, spdlog::async\_overflow\_policy::block);}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00073}00073         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < messages; i++)}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00074}00074         \{}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00075}00075             logger-\/>info(\textcolor{stringliteral}{"{}Hello message \#\{\}"{}}, i);}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00076}00076         \}}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00077}00077 }
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00078}00078         logger-\/>flush();}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00079}00079     \}}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00080}00080     \textcolor{comment}{// std::this\_thread::sleep\_for(std::chrono::milliseconds(250));}}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00081}00081     REQUIRE(test\_sink-\/>msg\_counter() == messages);}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00082}00082     REQUIRE(test\_sink-\/>flush\_counter() == 1);}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00083}00083 \}}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00084}00084 }
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00085}00085 TEST\_CASE(\textcolor{stringliteral}{"{}async periodic flush"{}}, \textcolor{stringliteral}{"{}[async]"{}})}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00086}00086 \{}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00087}00087 }
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00088}00088     \textcolor{keyword}{auto} logger = spdlog::create\_async<spdlog::sinks::test\_sink\_mt>(\textcolor{stringliteral}{"{}as"{}});}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00089}00089     \textcolor{keyword}{auto} test\_sink = std::static\_pointer\_cast<spdlog::sinks::test\_sink\_mt>(logger-\/>sinks()[0]);}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00090}00090 }
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00091}00091     spdlog::flush\_every(std::chrono::seconds(1));}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00092}00092     std::this\_thread::sleep\_for(std::chrono::milliseconds(1700));}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00093}00093     REQUIRE(test\_sink-\/>flush\_counter() == 1);}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00094}00094     spdlog::flush\_every(std::chrono::seconds(0));}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00095}00095     spdlog::drop\_all();}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00096}00096 \}}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00097}00097 }
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00098}00098 TEST\_CASE(\textcolor{stringliteral}{"{}tp-\/>wait\_empty() "{}}, \textcolor{stringliteral}{"{}[async]"{}})}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00099}00099 \{}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00100}00100     \textcolor{keyword}{auto} test\_sink = std::make\_shared<spdlog::sinks::test\_sink\_mt>();}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00101}00101     test\_sink-\/>set\_delay(std::chrono::milliseconds(5));}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00102}00102     \textcolor{keywordtype}{size\_t} messages = 100;}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00103}00103 }
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00104}00104     \textcolor{keyword}{auto} tp = std::make\_shared<spdlog::details::thread\_pool>(messages, 2);}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00105}00105     \textcolor{keyword}{auto} logger = std::make\_shared<spdlog::async\_logger>(\textcolor{stringliteral}{"{}as"{}}, test\_sink, tp, spdlog::async\_overflow\_policy::block);}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00106}00106     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < messages; i++)}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00107}00107     \{}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00108}00108         logger-\/>info(\textcolor{stringliteral}{"{}Hello message \#\{\}"{}}, i);}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00109}00109     \}}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00110}00110     logger-\/>flush();}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00111}00111     tp.reset();}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00112}00112 }
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00113}00113     REQUIRE(test\_sink-\/>msg\_counter() == messages);}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00114}00114     REQUIRE(test\_sink-\/>flush\_counter() == 1);}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00115}00115 \}}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00116}00116 }
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00117}00117 TEST\_CASE(\textcolor{stringliteral}{"{}multi threads"{}}, \textcolor{stringliteral}{"{}[async]"{}})}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00118}00118 \{}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00119}00119     \textcolor{keyword}{auto} test\_sink = std::make\_shared<spdlog::sinks::test\_sink\_mt>();}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00120}00120     \textcolor{keywordtype}{size\_t} queue\_size = 128;}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00121}00121     \textcolor{keywordtype}{size\_t} messages = 256;}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00122}00122     \textcolor{keywordtype}{size\_t} n\_threads = 10;}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00123}00123     \{}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00124}00124         \textcolor{keyword}{auto} tp = std::make\_shared<spdlog::details::thread\_pool>(queue\_size, 1);}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00125}00125         \textcolor{keyword}{auto} logger = std::make\_shared<spdlog::async\_logger>(\textcolor{stringliteral}{"{}as"{}}, test\_sink, tp, spdlog::async\_overflow\_policy::block);}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00126}00126 }
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00127}00127         std::vector<std::thread> threads;}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00128}00128         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < n\_threads; i++)}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00129}00129         \{}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00130}00130             threads.emplace\_back([logger, messages] \{}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00131}00131                 \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} j = 0; j < messages; j++)}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00132}00132                 \{}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00133}00133                     logger-\/>info(\textcolor{stringliteral}{"{}Hello message \#\{\}"{}}, j);}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00134}00134                 \}}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00135}00135             \});}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00136}00136             logger-\/>flush();}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00137}00137         \}}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00138}00138 }
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00139}00139         \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} \&t : threads)}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00140}00140         \{}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00141}00141             t.join();}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00142}00142         \}}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00143}00143     \}}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00144}00144 }
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00145}00145     REQUIRE(test\_sink-\/>msg\_counter() == messages * n\_threads);}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00146}00146     REQUIRE(test\_sink-\/>flush\_counter() == n\_threads);}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00147}00147 \}}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00148}00148 }
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00149}00149 TEST\_CASE(\textcolor{stringliteral}{"{}to\_file"{}}, \textcolor{stringliteral}{"{}[async]"{}})}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00150}00150 \{}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00151}00151     prepare\_logdir();}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00152}00152     \textcolor{keywordtype}{size\_t} messages = 1024;}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00153}00153     \textcolor{keywordtype}{size\_t} tp\_threads = 1;}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00154}00154     spdlog::filename\_t filename = SPDLOG\_FILENAME\_T(TEST\_FILENAME);}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00155}00155     \{}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00156}00156         \textcolor{keyword}{auto} file\_sink = std::make\_shared<spdlog::sinks::basic\_file\_sink\_mt>(filename, \textcolor{keyword}{true});}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00157}00157         \textcolor{keyword}{auto} tp = std::make\_shared<spdlog::details::thread\_pool>(messages, tp\_threads);}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00158}00158         \textcolor{keyword}{auto} logger = std::make\_shared<spdlog::async\_logger>(\textcolor{stringliteral}{"{}as"{}}, std::move(file\_sink), std::move(tp));}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00159}00159 }
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00160}00160         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} j = 0; j < messages; j++)}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00161}00161         \{}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00162}00162             logger-\/>info(\textcolor{stringliteral}{"{}Hello message \#\{\}"{}}, j);}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00163}00163         \}}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00164}00164     \}}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00165}00165 }
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00166}00166     require\_message\_count(TEST\_FILENAME, messages);}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00167}00167     \textcolor{keyword}{auto} contents = file\_contents(TEST\_FILENAME);}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00168}00168     \textcolor{keyword}{using} spdlog::details::os::default\_eol;}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00169}00169     REQUIRE(ends\_with(contents, spdlog::fmt\_lib::format(\textcolor{stringliteral}{"{}Hello message \#1023\{\}"{}}, default\_eol)));}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00170}00170 \}}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00171}00171 }
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00172}00172 TEST\_CASE(\textcolor{stringliteral}{"{}to\_file multi-\/workers"{}}, \textcolor{stringliteral}{"{}[async]"{}})}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00173}00173 \{}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00174}00174     prepare\_logdir();}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00175}00175     \textcolor{keywordtype}{size\_t} messages = 1024 * 10;}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00176}00176     \textcolor{keywordtype}{size\_t} tp\_threads = 10;}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00177}00177     spdlog::filename\_t filename = SPDLOG\_FILENAME\_T(TEST\_FILENAME);}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00178}00178     \{}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00179}00179         \textcolor{keyword}{auto} file\_sink = std::make\_shared<spdlog::sinks::basic\_file\_sink\_mt>(filename, \textcolor{keyword}{true});}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00180}00180         \textcolor{keyword}{auto} tp = std::make\_shared<spdlog::details::thread\_pool>(messages, tp\_threads);}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00181}00181         \textcolor{keyword}{auto} logger = std::make\_shared<spdlog::async\_logger>(\textcolor{stringliteral}{"{}as"{}}, std::move(file\_sink), std::move(tp));}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00182}00182 }
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00183}00183         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} j = 0; j < messages; j++)}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00184}00184         \{}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00185}00185             logger-\/>info(\textcolor{stringliteral}{"{}Hello message \#\{\}"{}}, j);}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00186}00186         \}}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00187}00187     \}}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00188}00188 }
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00189}00189     require\_message\_count(TEST\_FILENAME, messages);}
\DoxyCodeLine{\Hypertarget{test__async_8cpp_source_l00190}00190 \}}

\end{DoxyCode}
